!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self)._hyperscript=t()}(this,function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function i(e,t,n){return i=a()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&o(a,n.prototype),a},i.apply(null,arguments)}function u(e){var t="function"==typeof Map?new Map:void 0;return u=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return i(e,arguments,r(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,e)},u(e)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l;function f(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function m(e,t){var n=e[t];if(n)return n;var r={};return e[t]=r,r}function p(e,t){return new(e.bind.apply(e,[e].concat(t)))}var d=globalThis,h=function(e){function n(e,t){this._css=e,this.relativeToElement=t}return n.prototype[e]=function(){return T.getRootNode(this.relativeToElement).querySelectorAll(this.css)[Symbol.iterator]()},t(n,[{key:"css",get:function(){return T.escapeSelector(this._css)}},{key:"className",get:function(){return this._css.substr(1)}},{key:"id",get:function(){return this.className()}}]),n}(Symbol.iterator),v=function(){var e={"+":"PLUS","-":"MINUS","*":"MULTIPLY","/":"DIVIDE",".":"PERIOD","..":"ELLIPSIS","\\":"BACKSLASH",":":"COLON","%":"PERCENT","|":"PIPE","!":"EXCLAMATION","?":"QUESTION","#":"POUND","&":"AMPERSAND",$:"DOLLAR",";":"SEMI",",":"COMMA","(":"L_PAREN",")":"R_PAREN","<":"L_ANG",">":"R_ANG","<=":"LTE_ANG",">=":"GTE_ANG","==":"EQ","===":"EQQ","!=":"NEQ","!==":"NEQQ","{":"L_BRACE","}":"R_BRACE","[":"L_BRACKET","]":"R_BRACKET","=":"EQUALS"};function t(e){return i(e)||a(e)||"-"===e||"_"===e||":"===e}function n(e){return i(e)||a(e)||"-"===e||"_"===e||":"===e}function r(e){return" "===e||"\t"===e||o(e)}function o(e){return"\r"===e||"\n"===e}function a(e){return e>="0"&&e<="9"}function i(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function u(e,t){return"_"===e||"$"===e}function s(e,t,n){o();var r=null;function o(){for(;"WHITESPACE"===f(0,!0).type;)t.push(e.shift())}function a(e,t){E.raiseParseError(e,t)}function i(e){if(m()&&m().op&&m().value===e)return c()}function u(e,t,n,r){if(m()&&m().type&&[e,t,n,r].indexOf(m().type)>=0)return c()}function s(e,t){if(-1===p.indexOf(e))return t=t||"IDENTIFIER",m()&&m().value===e&&m().type===t?c():void 0}function c(){var n=e.shift();return t.push(n),r=n,o(),n}function l(n,r){for(var a=[],i=f(0,!0);!(null!=r&&i.type===r||null!=n&&i.value===n||"EOF"===i.type);){var u=e.shift();t.push(u),a.push(i),i=f(0,!0)}return o(),a}function f(t,n){var r,o=0;do{if(!n)for(;e[o]&&"WHITESPACE"===e[o].type;)o++;r=e[o],t--,o++}while(t>-1);return r||{type:"EOF",value:"<<<EOF>>>"}}function m(){return f(0)}var p=[];return{pushFollow:function(e){p.push(e)},popFollow:function(){p.pop()},clearFollow:function(){var e=p;return p=[],e},restoreFollow:function(e){p=e},matchAnyToken:function(e,t,n){for(var r=0;r<arguments.length;r++){var o=arguments[r],a=s(o);if(a)return a}},matchAnyOpToken:function(e,t,n){for(var r=0;r<arguments.length;r++){var o=arguments[r],a=i(o);if(a)return a}},matchOpToken:i,requireOpToken:function(e){var t=i(e);if(t)return t;a(this,"Expected '"+e+"' but found '"+m().value+"'")},matchTokenType:u,requireTokenType:function(e,t,n,r){var o=u(e,t,n,r);if(o)return o;a(this,"Expected one of "+JSON.stringify([e,t,n]))},consumeToken:c,matchToken:s,requireToken:function(e,t){var n=s(e,t);if(n)return n;a(this,"Expected '"+e+"' but found '"+m().value+"'")},list:e,consumed:t,source:n,hasMore:function(){return e.length>0},currentToken:m,lastMatch:function(){return r},token:f,consumeUntil:l,consumeUntilWhitespace:function(){return l(null,"WHITESPACE")},lastWhitespace:function(){return t[t.length-1]&&"WHITESPACE"===t[t.length-1].type?t[t.length-1].value:""},sourceFor:function(){return n.substring(this.startToken.start,this.endToken.end)},lineFor:function(){return n.split("\n")[this.startToken.line-1]}}}function c(e){if(e.length>0){var t=e[e.length-1];if("IDENTIFIER"===t.type||"CLASS_REF"===t.type||"ID_REF"===t.type)return!1;if(t.op&&(">"===t.value||")"===t.value))return!1}return!0}return{tokenize:function(l,f){var m,p=[],d=l,h=0,v=0,E=1,y="<START>",T=0;function k(){return f&&0===T}for(;h<d.length;)if("-"===C()&&"-"===R())x();else if(r(C()))p.push(P());else if(F()||"."!==C()||!i(R())&&"{"!==R())if(F()||"#"!==C()||!i(R())&&"{"!==R())if("["===C()&&"@"===R())p.push(w());else if("@"===C())p.push(q());else if(i(C())||!k()&&u(C()))p.push(O());else if(a(C()))p.push(N());else if(k()||'"'!==C()&&"`"!==C())if(k()||"'"!==C()){if(e[C()])"$"===y&&"{"===C()&&T++,"}"===C()&&T--,p.push(I());else if(k()||"`"===(m=C())||"^"===m)p.push(g("RESERVED",A()));else if(h<d.length)throw Error("Unknown token: "+C()+" ")}else c(p)?p.push(L()):p.push(I());else p.push(L());else p.push(S());else p.push(b());return s(p,[],d);function g(e,t){return{type:e,value:t,start:h,end:h+1,column:v,line:E}}function x(){for(;C()&&!o(C());)A();A()}function b(){var e=g("CLASS_REF"),n=A();if("{"===C()){for(e.template=!0,n+=A();C()&&"}"!==C();)n+=A();if("}"!==C())throw Error("Unterminated class reference");n+=A()}else for(;t(C());)n+=A();return e.value=n,e.end=h,e}function w(){for(var e=g("ATTRIBUTE_REF"),t=A();h<d.length&&"]"!==C();)t+=A();return"]"===C()&&(t+=A()),e.value=t,e.end=h,e}function q(){for(var e=g("ATTRIBUTE_REF"),t=A();n(C());)t+=A();return e.value=t,e.end=h,e}function S(){var e=g("ID_REF"),t=A();if("{"===C()){for(e.template=!0,t+=A();C()&&"}"!==C();)t+=A();if("}"!==C())throw Error("Unterminated id reference");A()}else for(;n(C());)t+=A();return e.value=t,e.end=h,e}function O(){for(var e=g("IDENTIFIER"),t=A();i(C())||u(C());)t+=A();return e.value=t,e.end=h,e}function N(){for(var e=g("NUMBER"),t=A();a(C());)t+=A();for("."===C()&&a(R())&&(t+=A());a(C());)t+=A();return e.value=t,e.end=h,e}function I(){for(var t=(r=void 0,(r=g(void 0,void 0)).op=!0,r),n=A();C()&&e[n+C()];)n+=A();var r;return t.type=e[n],t.value=n,t.end=h,t}function L(){for(var e,t=g("STRING"),n=A(),r="";C()&&C()!==n;)"\\"===C()&&A(),r+=A();if(C()!==n)throw Error("Unterminated string at [Line: "+(e=t).line+", Column: "+e.column+"]");return A(),t.value=r,t.end=h,t.template="`"===n,t}function C(){return d.charAt(h)}function R(){return d.charAt(h+1)}function A(){return y=C(),h++,v++,y}function F(){return i(y)||a(y)||")"===y||"}"===y||"]"===y}function P(){for(var e=g("WHITESPACE"),t="";C()&&r(C());)o(C())&&(v=0,E++),t+=A();return e.value=t,e.end=h,e}},makeTokensObject:s}}(),E=function(){var e={},t={},n={},r=[],o=[];function a(e,t,n){e.startToken=t,e.sourceFor=n.sourceFor,e.lineFor=n.lineFor,e.programSource=n.source}function i(t,n,r){return void 0===r&&(r=void 0),function(r){var o=e[t];if(o){var i=n.currentToken(),u=o(E,T,n,r);if(u)for(a(u,i,n),u.endToken=u.endToken||n.lastMatch(),r=u.root;null!=r;)a(r,i,n),r=r.root;return u}}(r)}function u(e,t,n,r){var o=i(e,t,r);return o||l(t,n||"Expected "+e),o}function s(e,t){for(var n=0;n<e.length;n++){var r=i(e[n],t);if(r)return r}}function c(t,n){e[t]=n}function l(e,t){t=(t||"Unexpected Token : "+e.currentToken().value)+"\n\n"+function(e){var t=e.currentToken(),n=e.source.split("\n"),r=n[t&&t.line?t.line-1:n.length-1];return r+"\n"+" ".repeat(t&&t.line?t.column:r.length-1)+"^^\n\n"}(e);var n=new Error(t);throw n.tokens=e,n}function f(e){return t[e.value]}function m(e){return n[e.value]}return c("feature",function(e,t,r){if(r.matchOpToken("(")){var o=e.requireElement("feature",r);return r.requireOpToken(")"),o}var a=n[r.currentToken().value];if(a)return a(e,t,r)}),c("command",function(e,n,r){if(r.matchOpToken("(")){var o=e.requireElement("command",r);return r.requireOpToken(")"),o}var a,i=t[r.currentToken().value];return i?a=i(e,n,r):"IDENTIFIER"===r.currentToken().type&&"("===r.token(1).value&&(a=e.requireElement("pseudoCommand",r)),a?e.parseElement("indirectStatement",r,a):a}),c("commandList",function(e,t,n){var r=e.parseElement("command",n);if(r){n.matchToken("then");var o=e.parseElement("commandList",n);return o&&(r.next=o),r}}),c("leaf",function(e,t,n){var o=s(r,n);return null==o?i("symbol",n):o}),c("indirectExpression",function(e,t,n,r){for(var a=0;a<o.length;a++){var i=o[a];r.endToken=n.lastMatch();var u=e.parseElement(i,n,r);if(u)return u}return r}),c("indirectStatement",function(e,t,n,r){if(n.matchToken("unless")){r.endToken=n.lastMatch();var o={type:"unlessStatementModifier",args:[e.requireElement("expression",n)],op:function(e,t){return t?this.next:r},execute:function(e){return t.unifiedExec(this,e)}};return r.parent=o,o}return r}),c("primaryExpression",function(e,t,n){var r=e.parseElement("leaf",n);if(r)return e.parseElement("indirectExpression",n,r);e.raiseParseError(n,"Unexpected value: "+n.currentToken().value)}),{setParent:function e(t,n){t&&(t.parent=n,e(t.next,n))},requireElement:u,parseElement:i,featureStart:m,commandStart:f,commandBoundary:function(e){return!("end"!=e.value&&"then"!=e.value&&"else"!=e.value&&")"!=e.value&&!f(e)&&!m(e)&&"EOF"!=e.type)},parseAnyOf:s,parseHyperScript:function(e){var t=i("hyperscript",e);if(e.hasMore()&&l(e),t)return t},raiseParseError:l,addGrammarElement:c,addCommand:function(n,r){var o=n+"Command",a=function(e,t,n){var a=r(e,t,n);if(a)return a.type=o,a.execute=function(e){return e.meta.command=a,t.unifiedExec(this,e)},a};e[o]=a,t[n]=a},addFeature:function(t,r){var o=t+"Feature",a=function(e,n,a){var i=r(e,n,a);if(i)return i.keyword=t,i.type=o,i};e[o]=a,n[t]=a},addLeafExpression:function(e,t){r.push(e),c(e,t)},addIndirectExpression:function(e,t){o.push(e),c(e,t)},parseStringTemplate:function(e){var t=[""];do{if(t.push(e.lastWhitespace()),"$"===e.currentToken().value){e.consumeToken();var n=e.matchOpToken("{");t.push(u("expression",e)),n&&e.requireOpToken("}"),t.push("")}else if("\\"===e.currentToken().value)e.consumeToken(),e.consumeToken();else{var r=e.consumeToken();t[t.length-1]+=r?r.value:""}}while(e.hasMore());return t.push(e.lastWhitespace()),t}}}(),y={dynamicResolvers:[],String:function(e){return e.toString?e.toString():""+e},Int:function(e){return parseInt(e)},Float:function(e){return parseFloat(e)},Number:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return console.log(e),Number(e)}),Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return new Date(e)}),Array:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return Array.from(e)}),JSON:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return JSON.stringify(e)}),Object:function(e){return e instanceof String&&(e=e.toString()),"string"==typeof e?JSON.parse(e):f({},e)}},T=function(){function e(e,t){var n=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return n&&n.call(e,t)}function t(e,t,n){(n=n||{}).sentBy=e;var r=function(e,t){var n;return d.Event&&"function"==typeof d.Event?(n=new Event(e,{bubbles:!0,cancelable:!0})).detail=t:(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,t),n}(t,n);return e.dispatchEvent(r)}function r(e){return Array.isArray(e)||"undefined"!=typeof NodeList&&e instanceof NodeList}function o(e){return e instanceof h||r(e)}function a(e,t){if(null==e);else if(function(e){return"object"==typeof e&&Symbol.iterator in e&&"function"==typeof e[Symbol.iterator]}(e))for(var n,o=c(e);!(n=o()).done;)t(n.value);else if(r(e))for(var a=0;a<e.length;a++)t(e[a]);else t(e)}var i={array_sentinel:!0};function s(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.asyncWrapper&&(e[t]=n.value),Array.isArray(n))for(var r=0;r<n.length;r++){var o=n[r];o.asyncWrapper&&(n[r]=o.value)}}}var p={};function k(e,t){for(;;){try{var n=g(e,t)}catch(r){if(T.registerHyperTrace(t,r),t.meta.errorHandler&&!t.meta.handlingError){t.meta.handlingError=!0,t[t.meta.errorSymmbol]=r,e=t.meta.errorHandler;continue}if(!t.meta.reject)throw r;t.meta.reject(r),n=p}if(null==n)return void console.error(e," did not return a next element to execute! context: ",t);if(n.then)return void n.then(function(e){k(e,t)}).catch(function(e){if(T.registerHyperTrace(t,e),t.meta.errorHandler&&!t.meta.handlingError)t.meta.handlingError=!0,t[t.meta.errorSymmbol]=e,k(t.meta.errorHandler,t);else{if(!t.meta.reject)throw e;t.meta.reject(e)}});if(n===p)return;e=n}}function g(e,t){var n=[t],r=!1,o=!1;if(e.args)for(var a=0;a<e.args.length;a++){var u=e.args[a];if(null==u)n.push(null);else if(Array.isArray(u)){for(var c=[],l=0;l<u.length;l++){var f=u[l];(m=f?f.evaluate(t):null)&&(m.then?r=!0:m.asyncWrapper&&(o=!0)),c.push(m)}n.push(c)}else if(u.evaluate){var m;(m=u.evaluate(t))&&(m.then?r=!0:m.asyncWrapper&&(o=!0)),n.push(m)}else n.push(u)}return r?new Promise(function(r,a){var u=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(Array.isArray(r)){t.push(i);for(var o=0;o<r.length;o++)t.push(r[o]);t.push(i)}else t.push(r)}return t}(n);Promise.all(u).then(function(t){t=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(r===i){r=e[++n];var o=[];for(t.push(o);r!==i;)o.push(r),r=e[++n]}else t.push(r)}return t}(t),o&&s(t);try{var n=e.op.apply(e,t);r(n)}catch(e){a(e)}}).catch(function(e){t.meta.errorHandler&&!t.meta.handlingError?(t.meta.handlingError=!0,t[t.meta.errorSymmbol]=e,k(t.meta.errorHandler,t)):t.meta.reject&&t.meta.reject(e)})}):(o&&s(n),e.op.apply(e,n))}var x=null;function b(){return null==x&&(x=l.config.attributes.replace(/ /g,"").split(",")),x}function w(e){for(var t=0;t<b().length;t++){var n=b()[t];if(e.hasAttribute&&e.hasAttribute(n))return e.getAttribute(n)}return e instanceof HTMLScriptElement&&"text/hyperscript"===e.type?e.innerText:null}var q=new WeakMap;function S(e){var t=q.get(e);return void 0===t&&q.set(e,t={}),t}function O(e,t){e&&(f(t,S(e)),O(e.parentElement,t))}function N(e,t,n,r){var o={meta:{parser:E,lexer:v,runtime:T,owner:e,feature:t,iterators:{}},me:n,event:r,target:r?r.target:null,detail:r?r.detail:null,body:"document"in d?document.body:null};return o.meta.ctx=o,O(e,o),o}function I(e){var t=v.tokenize(e);if(E.commandStart(t.currentToken())){for(var n=E.requireElement("commandList",t),r=n;r.next;)r=r.next;return r.next={op:function(){return p}},n}return E.featureStart(t.currentToken())?E.requireElement("hyperscript",t):E.requireElement("expression",t)}function L(e,n){if(!e.closest||!e.closest(l.config.disableSelector)){var r=R(e);if(!r.initialized){var o=w(e);if(o)try{r.initialized=!0,r.script=o;var a=v.tokenize(o),i=E.parseHyperScript(a);if(!i)return;i.apply(n||e,e),setTimeout(function(){t(n||e,"load",{hyperscript:!0})},1)}catch(t){T.triggerEvent(e,"exception",{error:t}),console.error("hyperscript errors were found on the following element:",e,"\n\n",t.message,t.stack)}}}}var C=new WeakMap;function R(e){var t=C.get(e);return void 0===t&&C.set(e,t={}),t}function A(e){var t=e.meta&&e.meta.owner;if(t){var n=R(t),r="elementScope";return e.meta.feature&&e.meta.feature.behavior&&(r=e.meta.feature.behavior+"Scope"),m(n,r)}return{}}return{typeCheck:function(e,t,n){return!(null!=e||!n)||Object.prototype.toString.call(e).slice(8,-1)===t},forEach:a,implicitLoop:function(e,t){if(o(e))for(var n,r=c(e);!(n=r()).done;)t(n.value);else t(e)},triggerEvent:t,matchesSelector:e,getScript:w,processNode:function(t){var n=T.getScriptSelector();e(t,n)&&L(t,t),t instanceof HTMLScriptElement&&"text/hyperscript"===t.type&&L(t,document.body),t.querySelectorAll&&a(t.querySelectorAll(n+", [type='text/hyperscript']"),function(e){L(e,e instanceof HTMLScriptElement&&"text/hyperscript"===e.type?document.body:e)})},evaluate:function(e,t,r){var o=function(e){function t(t){var n;return(n=e.call(this)||this).module=t,n}return n(t,e),t.prototype.toString=function(){return this.module.id},t}(u(EventTarget)),a="document"in d?d.document.body:new o(r&&r.module);t=f(N(a,null,a,null),t||{});var i=I(e);return i.execute?(i.execute(t),t.result):i.apply?(i.apply(a,a,r),S(a)):i.evaluate(t)},parse:I,getScriptSelector:function(){return b().map(function(e){return"["+e+"]"}).join(", ")},resolveSymbol:function(e,t,n){if("me"===e||"my"===e||"I"===e)return t.me;if("it"===e||"its"===e)return t.result;if("you"===e||"your"===e||"yourself"===e)return t.beingTold;if("global"===n)return d[e];if("element"===n)return A(t)[e];if("local"===n)return t[e];if(t.meta&&t.meta.context){var r=t.meta.context[e];if(void 0!==r)return r}var o=t[e];return void 0!==o||void 0!==(o=A(t)[e])?o:d[e]},setSymbol:function(e,t,n,r){if("global"===n)d[e]=r;else if("element"===n)(o=A(t))[e]=r;else if("local"===n)t[e]=r;else{var o,a=t[e];void 0!==a?t[e]=r:void 0!==(a=(o=A(t))[e])?o[e]=r:void 0!==(a=d[e])?d[e]=r:t[e]=r}},makeContext:N,findNext:function e(t,n){if(t)return t.resolveNext?t.resolveNext(n):t.next?t.next:e(t.parent,n)},unifiedEval:g,convertValue:function(e,t){for(var n=y.dynamicResolvers,r=0;r<n.length;r++){var o=(0,n[r])(t,e);if(void 0!==o)return o}if(null==e)return null;var a=y[t];if(a)return a(e);throw"Unknown conversion : "+t},unifiedExec:k,resolveProperty:function(e,t,n){if(null!=e){var r=n&&e.getAttribute?e.getAttribute(t):e[t];if(void 0!==r)return r;if(o(e)){for(var a,i=[],u=c(e);!(a=u()).done;){var s=a.value,l=n?s.getAttribute(t):s[t];l&&i.push(l)}return i}}},assignToNamespace:function(e,t,n,r){if("undefined"!=typeof document&&e===document.body)var o=d;else o=S(e);for(;t.length>0;){var a=t.shift(),i=o[a];null==i&&(o[a]=i={}),o=i}o[n]=r},registerHyperTrace:function(e,t){for(var n=[],r=null;null!=e;)n.push(e),r=e,e=e.meta.caller;null==r.meta.traceMap&&(r.meta.traceMap=new Map),r.meta.traceMap.get(t)||r.meta.traceMap.set(t,{trace:n,print:function(e){(e=e||console.error)("hypertrace /// ");for(var t=0,r=0;r<n.length;r++)t=Math.max(t,n[r].meta.feature.displayName.length);for(r=0;r<n.length;r++){var o=n[r];e("  ->",o.meta.feature.displayName.padEnd(t+2),"-",o.meta.owner)}}})},getHyperTrace:function(e,t){for(var n=e;n.meta.caller;)n=n.meta.caller;if(n.meta.traceMap)return n.meta.traceMap.get(t,[])},getInternalData:R,escapeSelector:function(e){return e.replace(/:/g,function(e){return"\\"+e})},nullCheck:function(e,t){if(null==e)throw new Error(t.sourceFor()+" is null")},isEmpty:function(e){return null==e||0===e.length},getRootNode:function(e){var t=e.getRootNode();return t instanceof Document||t instanceof ShadowRoot?t:document},hyperscriptUrl:"document"in d?"undefined"==typeof document&&"undefined"==typeof location?new(require("url").URL)("file:"+__filename).href:"undefined"==typeof document?location.href:document.currentScript&&document.currentScript.src||new URL("_hyperscript_w9y.min.js",document.baseURI).href:null,HALT:p}}();E.addLeafExpression("parenthesized",function(e,t,n){if(n.matchOpToken("(")){var r=n.clearFollow();try{var o=e.requireElement("expression",n)}finally{n.restoreFollow(r)}return n.requireOpToken(")"),o}}),E.addLeafExpression("string",function(e,t,n){var r=n.matchTokenType("STRING");if(r){var o,a=r.value;if(r.template){var i=v.tokenize(a,!0);o=e.parseStringTemplate(i)}else o=[];return{type:"string",token:r,args:o,op:function(e){for(var t="",n=1;n<arguments.length;n++){var r=arguments[n];void 0!==r&&(t+=r)}return t},evaluate:function(e){return 0===o.length?a:t.unifiedEval(this,e)}}}}),E.addGrammarElement("nakedString",function(e,t,n){if(n.hasMore()){var r=n.consumeUntilWhitespace();return n.matchTokenType("WHITESPACE"),{type:"nakedString",tokens:r,evaluate:function(e){return r.map(function(e){return e.value}).join("")}}}}),E.addLeafExpression("number",function(e,t,n){var r=n.matchTokenType("NUMBER");if(r){var o=r,a=parseFloat(r.value);return{type:"number",value:a,numberToken:o,evaluate:function(){return a}}}}),E.addLeafExpression("idRef",function(e,t,n){var r=n.matchTokenType("ID_REF");if(r){if(r.template){var o=r.value.substr(2,r.value.length-2),a=v.tokenize(o);return{type:"idRefTemplate",args:[e.requireElement("expression",a)],op:function(e,n){return t.getRootNode(e.me).getElementById(n)},evaluate:function(e){return t.unifiedEval(this,e)}}}var i=r.value.substr(1);return{type:"idRef",css:r.value,value:i,evaluate:function(e){return t.getRootNode(e.me).getElementById(i)}}}}),E.addLeafExpression("classRef",function(e,t,n){var r=n.matchTokenType("CLASS_REF");if(r){if(r.template){var o=r.value.substr(2,r.value.length-2),a=v.tokenize(o);return{type:"classRefTemplate",args:[e.requireElement("expression",a)],op:function(e,t){return new h("."+t,e.me)},evaluate:function(e){return t.unifiedEval(this,e)}}}var i=r.value;return{type:"classRef",css:i,evaluate:function(e){return new h(i,e.me)}}}});var k=function(e,r){function o(t,n,r){var o;return(o=e.call(this,t,n)||this).templateParts=r,o.elements=r.filter(function(e){return e instanceof Element}),o}return n(o,e),o.prototype[r]=function(){this.elements.forEach(function(e,t){return e.dataset.hsQueryId=t});var t=e.prototype[Symbol.iterator].call(this);return this.elements.forEach(function(e){return e.removeAttribute("data-hs-query-id")}),t},t(o,[{key:"css",get:function(){for(var e,t="",n=0,r=c(this.templateParts);!(e=r()).done;){var o=e.value;o instanceof Element?t+="[data-hs-query-id='"+n+++"']":t+=o}return t}}]),o}(h,Symbol.iterator);E.addLeafExpression("queryRef",function(e,t,n){if(n.matchOpToken("<")){var r=n.consumeUntil("/");n.requireOpToken("/"),n.requireOpToken(">");var o=r.map(function(e){return"STRING"===e.type?'"'+e.value+'"':e.value}).join("");if(o.indexOf("$")>=0)var a=!0,i=v.tokenize(o,!0),u=e.parseStringTemplate(i);return{type:"queryRef",css:o,args:u,op:function(e){return a?new k(o,e.me,[].slice.call(arguments,1)):new h(o,e.me)},evaluate:function(e){return t.unifiedEval(this,e)}}}}),E.addLeafExpression("attributeRef",function(e,t,n){var r=n.matchTokenType("ATTRIBUTE_REF");if(r){var o=r.value;if(0===o.indexOf("["))var a=o.substring(2,o.length-1);else a=o.substring(1);var i="["+a+"]",u=a.split("="),s=u[0],c=u[1];return c&&0===c.indexOf('"')&&(c=c.substring(1,c.length-1)),{type:"attributeRef",name:s,css:i,value:c,op:function(e){var t=e.beingTold||e.me;if(t)return t.getAttribute(s)},evaluate:function(e){return t.unifiedEval(this,e)}}}}),E.addGrammarElement("objectKey",function(e,t,n){var r;if(r=n.matchTokenType("STRING"))return{type:"objectKey",key:r.value,evaluate:function(){return r.value}};if(n.matchOpToken("[")){var o=e.parseElement("expression",n);return n.requireOpToken("]"),{type:"objectKey",expr:o,args:[o],op:function(e,t){return t},evaluate:function(e){return t.unifiedEval(this,e)}}}var a="";do{(r=n.matchTokenType("IDENTIFIER")||n.matchOpToken("-"))&&(a+=r.value)}while(r);return{type:"objectKey",key:a,evaluate:function(){return a}}}),E.addLeafExpression("objectLiteral",function(e,t,n){if(n.matchOpToken("{")){var r=[],o=[];if(!n.matchOpToken("}")){do{var a=e.requireElement("objectKey",n);n.requireOpToken(":");var i=e.requireElement("expression",n);o.push(i),r.push(a)}while(n.matchOpToken(","));n.requireOpToken("}")}return{type:"objectLiteral",args:[r,o],op:function(e,t,n){for(var r={},o=0;o<t.length;o++)r[t[o]]=n[o];return r},evaluate:function(e){return t.unifiedEval(this,e)}}}}),E.addGrammarElement("namedArgumentList",function(e,t,n){if(n.matchOpToken("(")){var r=[],o=[];if(!n.matchOpToken(")")){do{var a=n.requireTokenType("IDENTIFIER");n.requireOpToken(":");var i=e.requireElement("expression",n);o.push(i),r.push({name:a,value:i})}while(n.matchOpToken(","));n.requireOpToken(")")}return{type:"namedArgumentList",fields:r,args:[o],op:function(e,t){for(var n={_namedArgList_:!0},o=0;o<t.length;o++)n[r[o].name.value]=t[o];return n},evaluate:function(e){return t.unifiedEval(this,e)}}}}),E.addGrammarElement("symbol",function(e,t,n){var r="default";n.matchToken("global")?r="global":n.matchToken("element")||n.matchToken("module")?(r="element",n.matchOpToken("'")&&n.requireToken("s")):n.matchToken("local")&&(r="local");var o=n.matchTokenType("IDENTIFIER");if(o){var a=o.value;return{type:"symbol",symbolType:r,token:o,name:a,evaluate:function(e){return t.resolveSymbol(a,e,r)}}}}),E.addGrammarElement("implicitMeTarget",function(e,t,n){return{type:"implicitMeTarget",evaluate:function(e){return e.beingTold||e.me}}}),E.addLeafExpression("boolean",function(e,t,n){var r=n.matchToken("true")||n.matchToken("false");if(r){var o="true"===r.value;return{type:"boolean",evaluate:function(e){return o}}}}),E.addLeafExpression("null",function(e,t,n){if(n.matchToken("null"))return{type:"null",evaluate:function(e){return null}}}),E.addLeafExpression("arrayLiteral",function(e,t,n){if(n.matchOpToken("[")){var r=[];if(!n.matchOpToken("]")){do{var o=e.requireElement("expression",n);r.push(o)}while(n.matchOpToken(","));n.requireOpToken("]")}return{type:"arrayLiteral",values:r,args:[r],op:function(e,t){return t},evaluate:function(e){return t.unifiedEval(this,e)}}}}),E.addLeafExpression("blockLiteral",function(e,t,n){if(n.matchOpToken("\\")){var r=[],o=n.matchTokenType("IDENTIFIER");if(o)for(r.push(o);n.matchOpToken(",");)r.push(n.requireTokenType("IDENTIFIER"));n.requireOpToken("-"),n.requireOpToken(">");var a=e.requireElement("expression",n);return{type:"blockLiteral",args:r,expr:a,evaluate:function(e){return function(){for(var t=0;t<r.length;t++)e[r[t].value]=arguments[t];return a.evaluate(e)}}}}}),E.addGrammarElement("timeExpression",function(e,t,n){var r=e.requireElement("expression",n),o=1;return n.matchToken("s")||n.matchToken("seconds")?o=1e3:n.matchToken("ms")||n.matchToken("milliseconds"),{type:"timeExpression",time:r,factor:o,args:[r],op:function(e,t){return t*o},evaluate:function(e){return t.unifiedEval(this,e)}}}),E.addIndirectExpression("propertyAccess",function(e,t,n,r){if(n.matchOpToken(".")){var o=n.requireTokenType("IDENTIFIER");return e.parseElement("indirectExpression",n,{type:"propertyAccess",root:r,prop:o,args:[r],op:function(e,n){return t.resolveProperty(n,o.value,!1)},evaluate:function(e){return t.unifiedEval(this,e)}})}}),E.addIndirectExpression("of",function(e,t,n,r){if(n.matchToken("of")){for(var o=e.requireElement("expression",n),a=null,i=r;i.root;)a=i,i=i.root;"symbol"!==i.type&&"attributeRef"!==i.type&&e.raiseParseError(n,"Cannot take a property of a non-symbol: "+i.type);var u="attributeRef"===i.type,s=i.name,c={type:"ofExpression",prop:i.token,root:o,attribute:u,expression:r,args:[o],op:function(e,n){return t.resolveProperty(n,s,u)},evaluate:function(e){return t.unifiedEval(this,e)}};return"attributeRef"===i.type&&(c.attribute=i),a?(a.root=c,a.args=[c]):r=c,e.parseElement("indirectExpression",n,r)}}),E.addIndirectExpression("possessive",function(e,t,n,r){if(!e.possessivesDisabled){var o=n.matchOpToken("'");if(o||"symbol"===r.type&&("my"===r.name||"its"===r.name||"your"===r.name)&&"IDENTIFIER"===n.currentToken().type){o&&n.requireToken("s");var a=e.parseElement("attributeRef",n);if(null==a)var i=n.requireTokenType("IDENTIFIER");return e.parseElement("indirectExpression",n,{type:"possessive",root:r,attribute:a,prop:i,args:[r],op:function(e,n){if(a)var r=t.resolveProperty(n,a.name,!0);else r=t.resolveProperty(n,i.value,!1);return r},evaluate:function(e){return t.unifiedEval(this,e)}})}}}),E.addIndirectExpression("inExpression",function(e,t,n,r){if(n.matchToken("in")){if("idRef"!==r.type&&"queryRef"===r.type||"classRef"===r.type)var o=!0;var a=e.requireElement("expression",n),i={type:"inExpression",root:r,args:[o?null:r,a],op:function(e,n,a){var i=[];return o?t.forEach(a,function(e){for(var t=e.querySelectorAll(r.css),n=0;n<t.length;n++)i.push(t[n])}):t.forEach(n,function(e){t.forEach(a,function(t){e===t&&i.push(e)})}),i.length>0?i:null},evaluate:function(e){return t.unifiedEval(this,e)}};return e.parseElement("indirectExpression",n,i)}}),E.addIndirectExpression("asExpression",function(e,t,n,r){if(n.matchToken("as")){var o=e.requireElement("dotOrColonPath",n).evaluate();return e.parseElement("indirectExpression",n,{type:"asExpression",root:r,args:[r],op:function(e,n){return t.convertValue(n,o)},evaluate:function(e){return t.unifiedEval(this,e)}})}}),E.addIndirectExpression("functionCall",function(e,t,n,r){if(n.matchOpToken("(")){var o=[];if(!n.matchOpToken(")")){do{o.push(e.requireElement("expression",n))}while(n.matchOpToken(","));n.requireOpToken(")")}if(r.root)var a={type:"functionCall",root:r,argExressions:o,args:[r.root,o],op:function(e,n,o){t.nullCheck(n,r.root);var a=n[r.prop.value];return t.nullCheck(a,r),a.hyperfunc&&o.push(e),a.apply(n,o)},evaluate:function(e){return t.unifiedEval(this,e)}};else a={type:"functionCall",root:r,argExressions:o,args:[r,o],op:function(e,n,o){return t.nullCheck(n,r),n.hyperfunc&&o.push(e),n.apply(null,o)},evaluate:function(e){return t.unifiedEval(this,e)}};return e.parseElement("indirectExpression",n,a)}}),E.addIndirectExpression("attributeRefAccess",function(e,t,n,r){var o=e.parseElement("attributeRef",n);if(o)return{type:"attributeRefAccess",root:r,attribute:o,args:[r],op:function(e,n){return t.resolveProperty(n,o.name,!0)},evaluate:function(e){return T.unifiedEval(this,e)}}}),E.addIndirectExpression("arrayIndex",function(e,t,n,r){if(n.matchOpToken("[")){var o=!1,a=!1,i=null,u=null;n.matchOpToken("..")?(o=!0,i=e.requireElement("expression",n)):(i=e.requireElement("expression",n),n.matchOpToken("..")&&(a=!0,"R_BRACKET"!==n.currentToken().type&&(u=e.parseElement("expression",n)))),n.requireOpToken("]");var s={type:"arrayIndex",root:r,firstIndex:i,secondIndex:u,args:[r,i,u],op:function(e,t,n,r){return o?t.slice(0,n+1):a?null!=r?t.slice(n,r+1):t.slice(n):t[n]},evaluate:function(e){return T.unifiedEval(this,e)}};return E.parseElement("indirectExpression",n,s)}}),E.addGrammarElement("postfixExpression",function(e,t,n){var r=e.parseElement("primaryExpression",n);if(n.matchOpToken(":")){var o=n.requireTokenType("IDENTIFIER"),a=!n.matchOpToken("!");return{type:"typeCheck",typeName:o,nullOk:a,args:[r],op:function(e,n){if(t.typeCheck(n,o.value,a))return n;throw new Error("Typecheck failed!  Expected: "+o.value)},evaluate:function(e){return t.unifiedEval(this,e)}}}return r}),E.addGrammarElement("logicalNot",function(e,t,n){if(n.matchToken("not")){var r=e.requireElement("unaryExpression",n);return{type:"logicalNot",root:r,args:[r],op:function(e,t){return!t},evaluate:function(e){return t.unifiedEval(this,e)}}}}),E.addGrammarElement("noExpression",function(e,t,n){if(n.matchToken("no")){var r=e.requireElement("unaryExpression",n);return{type:"noExpression",root:r,args:[r],op:function(e,n){return t.isEmpty(n)},evaluate:function(e){return t.unifiedEval(this,e)}}}}),E.addGrammarElement("negativeNumber",function(e,t,n){if(n.matchOpToken("-")){var r=e.requireElement("unaryExpression",n);return{type:"negativeNumber",root:r,args:[r],op:function(e,t){return-1*t},evaluate:function(e){return t.unifiedEval(this,e)}}}}),E.addGrammarElement("unaryExpression",function(e,t,n){return e.parseAnyOf(["logicalNot","relativePositionalExpression","positionalExpression","noExpression","negativeNumber","postfixExpression"],n)});var g=function(e,t,n,r){var o=[];T.forEach(t,function(t){(t.matches(n)||t===e)&&o.push(t)});for(var a=0;a<o.length-1;a++)if(o[a]===e)return o[a+1];if(r){var i=o[0];if(i&&i.matches(n))return i}};E.addGrammarElement("relativePositionalExpression",function(e,t,n){var r=n.matchAnyToken("next","previous");if(r){if("next"===r.value)var o=!0;var a=e.parseElement("expression",n);if(n.matchToken("from")){n.pushFollow("in");try{var i=e.requireElement("expression",n)}finally{n.popFollow()}}else i=e.requireElement("implicitMeTarget",n);var u,s=!1;if(n.matchToken("in")){s=!0;var c=e.requireElement("expression",n)}else u=n.matchToken("within")?e.requireElement("expression",n):document.body;var l=!1;return n.matchToken("with")&&(n.requireToken("wrapping"),l=!0),{type:"relativePositionalExpression",from:i,forwardSearch:o,inSearch:s,wrapping:l,inElt:c,withinElt:u,operator:r.value,args:[a,i,c,u],op:function(e,t,n,r,a){var i,u,c=t.css;if(null==c)throw"Expected a CSS value";if(s){if(r)return o?g(n,r,c,l):(i=c,u=l,g(n,Array.from(r).reverse(),i,u))}else if(a)return o?function(e,t,n,r){for(var o=t.querySelectorAll(n),a=0;a<o.length;a++){var i=o[a];if(i.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_PRECEDING)return i}if(r)return o[0]}(n,a,c,l):function(e,t,n,r){for(var o=t.querySelectorAll(n),a=o.length-1;a>=0;a--){var i=o[a];if(i.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_FOLLOWING)return i}if(r)return o[o.length-1]}(n,a,c,l)},evaluate:function(e){return t.unifiedEval(this,e)}}}}),E.addGrammarElement("positionalExpression",function(e,t,n){var r=n.matchAnyToken("first","last","random");if(r){n.matchAnyToken("in","from","of");var o=e.requireElement("unaryExpression",n),a=r.value;return{type:"positionalExpression",rhs:o,operator:r.value,args:[o],op:function(e,t){if(t&&!Array.isArray(t)&&(t=t.children?t.children:Array.from(t)),t){if("first"===a)return t[0];if("last"===a)return t[t.length-1];if("random"===a)return t[Math.floor(Math.random()*t.length)]}},evaluate:function(e){return t.unifiedEval(this,e)}}}}),E.addGrammarElement("mathOperator",function(e,t,n){var r,o=e.parseElement("unaryExpression",n),a=null;for(r=n.matchAnyOpToken("+","-","*","/","%");r;){var i=r.value;(a=a||r).value!==i&&e.raiseParseError(n,"You must parenthesize math operations with different operators");var u=e.parseElement("unaryExpression",n);o={type:"mathOperator",lhs:o,rhs:u,operator:i,args:[o,u],op:function(e,t,n){return"+"===i?t+n:"-"===i?t-n:"*"===i?t*n:"/"===i?t/n:"%"===i?t%n:void 0},evaluate:function(e){return t.unifiedEval(this,e)}},r=n.matchAnyOpToken("+","-","*","/","%")}return o}),E.addGrammarElement("mathExpression",function(e,t,n){return e.parseAnyOf(["mathOperator","unaryExpression"],n)}),E.addGrammarElement("comparisonOperator",function(e,t,n){var r=e.parseElement("mathExpression",n),o=n.matchAnyOpToken("<",">","<=",">=","==","===","!=","!=="),a=o?o.value:null,i=!0,u=!1;if(null==a&&(n.matchToken("is")||n.matchToken("am")?n.matchToken("not")?n.matchToken("in")?a="not in":n.matchToken("a")?(a="not a",u=!0):n.matchToken("empty")?(a="not empty",i=!1):a="!=":n.matchToken("in")?a="in":n.matchToken("a")?(a="a",u=!0):n.matchToken("empty")?(a="empty",i=!1):a="==":n.matchToken("matches")||n.matchToken("match")?a="match":n.matchToken("contains")||n.matchToken("contain")?a="contain":(n.matchToken("do")||n.matchToken("does"))&&(n.requireToken("not"),n.matchToken("matches")||n.matchToken("match")?a="not match":n.matchToken("contains")||n.matchToken("contain")?a="not contain":e.raiseParseError(n,"Expected matches or contains"))),a){if(u)var s=n.requireTokenType("IDENTIFIER"),c=!n.matchOpToken("!");else if(i){var l=e.requireElement("mathExpression",n);"match"!==a&&"not match"!==a||(l=l.css?l.css:l)}r={type:"comparisonOperator",operator:a,typeName:s,nullOk:c,lhs:r,rhs:l,args:[r,l],op:function(e,n,r){if("=="===a)return n==r;if("!="===a)return n!=r;if("in"===a)return null!=r&&Array.from(r).indexOf(n)>=0;if("not in"===a)return null==r||Array.from(r).indexOf(n)<0;if("match"===a)return null!=n&&n.matches(r);if("not match"===a)return null==n||!n.matches(r);if("contain"===a)return null!=n&&n.contains(r);if("not contain"===a)return null==n||!n.contains(r);if("==="===a)return n===r;if("!=="===a)return n!==r;if("<"===a)return n<r;if(">"===a)return n>r;if("<="===a)return n<=r;if(">="===a)return n>=r;if("empty"===a)return t.isEmpty(n);if("not empty"===a)return!t.isEmpty(n);if("a"===a)return t.typeCheck(n,s.value,c);if("not a"===a)return!t.typeCheck(n,s.value,c);throw"Unknown comparison : "+a},evaluate:function(e){return t.unifiedEval(this,e)}}}return r}),E.addGrammarElement("comparisonExpression",function(e,t,n){return e.parseAnyOf(["comparisonOperator","mathExpression"],n)}),E.addGrammarElement("logicalOperator",function(e,t,n){var r,o=e.parseElement("comparisonExpression",n),a=null;r=n.matchToken("and")||n.matchToken("or");for(var i=function(){(a=a||r).value!==r.value&&e.raiseParseError(n,"You must parenthesize logical operations with different operators"),u=e.requireElement("comparisonExpression",n);var i=r.value;o={type:"logicalOperator",operator:i,lhs:o,rhs:u,args:[o,u],op:function(e,t,n){return"and"===i?t&&n:t||n},evaluate:function(e){return t.unifiedEval(this,e)}},r=n.matchToken("and")||n.matchToken("or")};r;){var u;i()}return o}),E.addGrammarElement("logicalExpression",function(e,t,n){return e.parseAnyOf(["logicalOperator","mathExpression"],n)}),E.addGrammarElement("asyncExpression",function(e,t,n){return n.matchToken("async")?{type:"asyncExpression",value:e.requireElement("logicalExpression",n),evaluate:function(e){return{asyncWrapper:!0,value:this.value.evaluate(e)}}}:e.parseElement("logicalExpression",n)}),E.addGrammarElement("expression",function(e,t,n){return n.matchToken("the"),e.parseElement("asyncExpression",n)}),E.addGrammarElement("assignableExpression",function(e,t,n){n.matchToken("the");var r=e.parseElement("primaryExpression",n);return!r||"symbol"!==r.type&&"ofExpression"!==r.type&&"propertyAccess"!==r.type&&"attributeRefAccess"!==r.type&&"attributeRef"!==r.type&&"possessive"!==r.type?(E.raiseParseError(n,"A target expression must be writable.  The expression type '"+(r&&r.type)+"' is not."),r):r}),E.addGrammarElement("hyperscript",function(e,t,n){var r=[];if(n.hasMore())for(;e.featureStart(n.currentToken())||"("===n.currentToken().value;){var o=e.requireElement("feature",n);r.push(o),n.matchToken("end")}return{type:"hyperscript",features:r,apply:function(e,t,n){T.forEach(r,function(r){r.install(e,t,n)})}}});var x=function(e){var t=[];if("("===e.token(0).value&&(")"===e.token(1).value||","===e.token(2).value||")"===e.token(2).value)){e.matchOpToken("(");do{t.push(e.requireTokenType("IDENTIFIER"))}while(e.matchOpToken(","));e.requireOpToken(")")}return t};E.addFeature("on",function(e,t,n){if(n.matchToken("on")){var r=!1;n.matchToken("every")&&(r=!0);var o=[],a=null;do{var i=e.requireElement("eventName",n,"Expected event name").evaluate();a=a?a+" or "+i:"on "+i;var u=x(n),s=null;if(n.matchOpToken("[")&&(s=e.requireElement("expression",n),n.requireOpToken("]")),"NUMBER"===n.currentToken().type){var c=n.consumeToken(),l=parseInt(c.value);if(n.matchToken("to"))var m=n.consumeToken(),p=parseInt(m.value);else if(n.matchToken("and")){var d=!0;n.requireToken("on")}}if("intersection"===i){var h={};if(n.matchToken("with")&&(h.with=e.requireElement("expression",n).evaluate()),n.matchToken("having"))do{n.matchToken("margin")?h.rootMargin=e.requireElement("stringLike",n).evaluate():n.matchToken("threshold")?h.threshold=e.requireElement("expression",n).evaluate():e.raiseParseError(n,"Unknown intersection config specification")}while(n.matchToken("and"))}else if("mutation"===i){var v={};if(n.matchToken("of"))do{if(n.matchToken("anything"))v.attributes=!0,v.subtree=!0,v.characterData=!0,v.childList=!0;else if(n.matchToken("childList"))v.childList=!0;else if(n.matchToken("attributes"))v.attributes=!0,v.attributeOldValue=!0;else if(n.matchToken("subtree"))v.subtree=!0;else if(n.matchToken("characterData"))v.characterData=!0,v.characterDataOldValue=!0;else if("ATTRIBUTE_REF"===n.currentToken().type){var E=n.consumeToken();null==v.attributeFilter&&(v.attributeFilter=[]),0==E.value.indexOf("@")?v.attributeFilter.push(E.value.substring(1)):e.raiseParseError(n,"Only shorthand attribute references are allowed here")}else e.raiseParseError(n,"Unknown mutation config specification")}while(n.matchToken("or"));else v.attributes=!0,v.characterData=!0,v.childList=!0}var y=null,k=!1;if(n.matchToken("from")&&(n.matchToken("elsewhere")?k=!0:(y=e.parseElement("expression",n))||e.raiseParseError(n,'Expected either target value or "elsewhere".')),null===y&&!1===k&&n.matchToken("elsewhere")&&(k=!0),n.matchToken("in"))var g=e.parseAnyOf(["idRef","queryRef","classRef"],n);if(n.matchToken("debounced")){n.requireToken("at");var b=e.requireElement("timeExpression",n).evaluate({})}else if(n.matchToken("throttled")){n.requireToken("at");var w=e.requireElement("timeExpression",n).evaluate({})}o.push({execCount:0,every:r,on:i,args:u,filter:s,from:y,inExpr:g,elsewhere:k,startCount:l,endCount:p,unbounded:d,debounceTime:b,throttleTime:w,mutationSpec:v,intersectionSpec:h})}while(n.matchToken("or"));var q=[],S=!0;if(!r&&n.matchToken("queue"))if(n.matchToken("all"))S=!1;else if(n.matchToken("first"))var O=!0;else if(n.matchToken("none"))var N=!0;else n.requireToken("last");var I=e.parseElement("commandList",n),L={type:"implicitReturn",op:function(e){return e.meta.resolve(),t.HALT},execute:function(e){}};if(I){for(var C=I,R=C;R.next;)R=R.next;R.next=L}else C=L;var A={displayName:a,events:o,start:C,every:r,executing:!1,execCount:0,queue:q,execute:function(e){if(this.executing&&!1===r){if(N||O&&q.length>0)return;return S&&(A.queue.length=0),void A.queue.push(e)}A.execCount++,this.executing=!0,e.meta.resolve=function(){A.executing=!1;var e=A.queue.shift();e&&setTimeout(function(){A.execute(e)},1)},e.meta.reject=function(n){console.error(n.message?n.message:n);var r=t.getHyperTrace(e,n);r&&r.print(),t.triggerEvent(e.me,"exception",{error:n}),A.executing=!1;var o=A.queue.shift();o&&setTimeout(function(){A.execute(o)},1)},C.execute(e)},install:function(e,n){t.forEach(A.events,function(n){var r;r=n.elsewhere?[document]:n.from?n.from.evaluate({me:e,meta:{owner:e,feature:A}}):[e],t.forEach(r,function(r){var o=n.on;if(n.mutationSpec&&(o="hyperscript:mutation",new MutationObserver(function(e,t){console.log(r,e),A.executing||T.triggerEvent(r,o,{mutationList:e,observer:t})}).observe(r,n.mutationSpec)),n.intersectionSpec){o="hyperscript:insersection";var a=new IntersectionObserver(function(e){T.forEach(e,function(e){var t={observer:a};(t=f(t,e)).intersecting=e.isIntersecting,T.triggerEvent(r,o,t)})},n.intersectionSpec);a.observe(r)}(r.addEventListener||r.on).call(r,o,function a(i){if("undefined"!=typeof Node&&e instanceof Node&&r!==e&&!e.isConnected)r.removeEventListener(o,a);else{var u=t.makeContext(e,A,e,i);if(!n.elsewhere||!e.contains(i.target)){if(n.from&&(u.result=r),t.forEach(n.args,function(e){u[e.value]=u.event[e.value]||("detail"in u.event?u.event.detail[e.value]:null)}),n.filter){var s=u.meta.context;u.meta.context=u.event;try{if(!n.filter.evaluate(u))return}finally{u.meta.context=s}}if(n.inExpr)for(var c=i.target;;){if(c.matches&&c.matches(n.inExpr.css)){u.result=c;break}if(null==(c=c.parentElement))return}if(n.execCount++,n.startCount)if(n.endCount){if(n.execCount<n.startCount||n.execCount>n.endCount)return}else if(n.unbounded){if(n.execCount<n.startCount)return}else if(n.execCount!==n.startCount)return;if(n.debounceTime)return n.debounced&&clearTimeout(n.debounced),void(n.debounced=setTimeout(function(){A.execute(u)},n.debounceTime));if(n.throttleTime){if(n.lastExec&&Date.now()<n.lastExec+n.throttleTime)return;n.lastExec=Date.now()}A.execute(u)}}})})})}};return e.setParent(C,A),A}}),E.addFeature("def",function(e,t,n){if(n.matchToken("def")){var r=e.requireElement("dotOrColonPath",n).evaluate(),o=r.split("."),a=o.pop(),i=[];if(n.matchOpToken("("))if(n.matchOpToken(")"));else{do{i.push(n.requireTokenType("IDENTIFIER"))}while(n.matchOpToken(","));n.requireOpToken(")")}var u=e.requireElement("commandList",n);if(n.matchToken("catch"))var s=n.requireTokenType("IDENTIFIER").value,c=e.parseElement("commandList",n);var l={displayName:a+"("+i.map(function(e){return e.value}).join(", ")+")",name:a,args:i,start:u,errorHandler:c,errorSymbol:s,install:function(e,n){var f=function(){var r=t.makeContext(n,l,e,null);r.meta.errorHandler=c,r.meta.errorSymmbol=s;for(var o=0;o<i.length;o++){var a=i[o],f=arguments[o];a&&(r[a.value]=f)}r.meta.caller=arguments[i.length],r.meta.caller&&(r.meta.callingCommand=r.meta.caller.meta.command);var m,p=null,d=new Promise(function(e,t){m=e,p=t});return u.execute(r),r.meta.returned?r.meta.returnValue:(r.meta.resolve=m,r.meta.reject=p,d)};f.hyperfunc=!0,f.hypername=r,t.assignToNamespace(e,o,a,f)}},f={type:"implicitReturn",op:function(e){return e.meta.returned=!0,e.meta.resolve&&e.meta.resolve(),t.HALT},execute:function(e){}};if(u){for(var m=u;m.next;)m=m.next;m.next=f}else l.start=f;if(c){for(m=c;m.next;)m=m.next;m.next=f}return e.setParent(u,l),l}}),E.addFeature("init",function(e,t,n){if(n.matchToken("init")){var r=n.matchToken("immediately"),o=e.parseElement("commandList",n),a={start:o,install:function(e,n){r?o&&o.execute(t.makeContext(e,this,e,null)):setTimeout(function(){o&&o.execute(t.makeContext(e,this,e,null))},0)}},i={type:"implicitReturn",op:function(e){return t.HALT},execute:function(e){}};if(o){for(var u=o;u.next;)u=u.next;u.next=i}else a.start=i;return e.setParent(o,a),a}}),E.addFeature("worker",function(e,t,n){n.matchToken("worker")&&e.raiseParseError(n,"In order to use the 'worker' feature, include the _hyperscript worker plugin. See https://hyperscript.org/features/worker/ for more info.")}),E.addFeature("behavior",function(e,t,n){if(n.matchToken("behavior")){var r=e.requireElement("dotOrColonPath",n).evaluate(),o=r.split("."),a=o.pop(),i=[];if(n.matchOpToken("(")&&!n.matchOpToken(")")){do{i.push(n.requireTokenType("IDENTIFIER").value)}while(n.matchOpToken(","));n.requireOpToken(")")}for(var u=e.requireElement("hyperscript",n),s=0;s<u.features.length;s++)u.features[s].behavior=r;return{install:function(e,n){t.assignToNamespace(d.document&&d.document.body,o,a,function(e,n,o){for(var a=m(t.getInternalData(e),r+"Scope"),s=0;s<i.length;s++)a[i[s]]=o[i[s]];u.apply(e,n)})}}}}),E.addFeature("install",function(e,t,n){if(n.matchToken("install")){var r,o=e.requireElement("dotOrColonPath",n).evaluate(),a=o.split("."),i=e.parseElement("namedArgumentList",n);return r={install:function(e,n){t.unifiedEval({args:[i],op:function(t,r){for(var i=d,u=0;u<a.length;u++)if("object"!=typeof(i=i[a[u]])&&"function"!=typeof i)throw new Error("No such behavior defined as "+o);if(!(i instanceof Function))throw new Error(o+" is not a behavior");i(e,n,r)}},t.makeContext(e,r,e))}}}}),E.addGrammarElement("jsBody",function(e,t,n){for(var r=n.currentToken().start,o=n.currentToken(),a=[],i="",u=!1;n.hasMore();){o=n.consumeToken();var s=n.token(0,!0);if("IDENTIFIER"===s.type&&"end"===s.value)break;u?"IDENTIFIER"===o.type||"NUMBER"===o.type?i+=o.value:(""!==i&&a.push(i),i="",u=!1):"IDENTIFIER"===o.type&&"function"===o.value&&(u=!0)}return{type:"jsBody",exposedFunctionNames:a,jsSource:n.source.substring(r,o.end+1)}}),E.addFeature("js",function(e,t,n){if(n.matchToken("js")){var r=e.requireElement("jsBody",n),o=r.jsSource+"\nreturn { "+r.exposedFunctionNames.map(function(e){return e+":"+e}).join(",")+" } ",a=new Function(o);return{jsSource:o,function:a,exposedFunctionNames:r.exposedFunctionNames,install:function(){f(d,a())}}}}),E.addCommand("js",function(e,t,n){if(n.matchToken("js")){var r=[];if(n.matchOpToken("("))if(n.matchOpToken(")"));else{do{var o=n.requireTokenType("IDENTIFIER");r.push(o.value)}while(n.matchOpToken(","));n.requireOpToken(")")}var a=e.requireElement("jsBody",n);n.matchToken("end");var i=p(Function,r.concat([a.jsSource]));return{jsSource:a.jsSource,function:i,inputs:r,op:function(e){var n=[];r.forEach(function(r){n.push(t.resolveSymbol(r,e,"default"))});var o=i.apply(d,n);return o&&"function"==typeof o.then?new Promise(function(n){o.then(function(r){e.result=r,n(t.findNext(this,e))})}):(e.result=o,t.findNext(this,e))}}}}),E.addCommand("async",function(e,t,n){if(n.matchToken("async")){if(n.matchToken("do")){for(var r=o=e.requireElement("commandList",n);r.next;)r=r.next;r.next=t.HALT,n.requireToken("end")}else var o=e.requireElement("command",n);return{body:o,op:function(e){return setTimeout(function(){o.execute(e)}),t.findNext(this,e)}}}}),E.addCommand("tell",function(e,t,n){var r=n.currentToken();if(n.matchToken("tell")){var o=e.requireElement("expression",n),a=e.requireElement("commandList",n);n.hasMore()&&n.requireToken("end");var i="tell_"+r.start,u={value:o,body:a,args:[o],resolveNext:function(e){var n=e.meta.iterators[i];return n.index<n.value.length?(e.beingTold=n.value[n.index++],a):(e.beingTold=n.originalBeingTold,this.next?this.next:t.findNext(this.parent,e))},op:function(e,t){return null==t?t=[]:Array.isArray(t)||t instanceof NodeList||(t=[t]),e.meta.iterators[i]={originalBeingTold:e.beingTold,index:0,value:t},this.resolveNext(e)}};return e.setParent(a,u),u}}),E.addCommand("wait",function(e,t,n){if(n.matchToken("wait")){var r,o;if(n.matchToken("for")){n.matchToken("a");var a=[];do{var i=n.token(0);a.push("NUMBER"===i.type||"L_PAREN"===i.type?{time:e.requireElement("timeExpression",n).evaluate()}:{name:E.requireElement("dotOrColonPath",n,"Expected event name").evaluate(),args:x(n)})}while(n.matchToken("or"));if(n.matchToken("from"))var u=e.requireElement("expression",n);return r={event:a,on:u,args:[u],op:function(e,n){var r=this,o=n||e.me;if(!(o instanceof EventTarget))throw new Error("Not a valid event target: "+this.on.sourceFor());return new Promise(function(n){var i=!1;t.forEach(a,function(a){var u=function(o){e.result=o,t.forEach(a.args,function(t){e[t.value]=o[t.value]||(o.detail?o.detail[t.value]:null)}),i||(i=!0,n(t.findNext(r,e)))};a.name?o.addEventListener(a.name,u,{once:!0}):a.time&&setTimeout(u,a.time,a.time)})})}},r}return n.matchToken("a")?(n.requireToken("tick"),o=0):o=E.requireElement("timeExpression",n),{type:"waitCmd",time:o,args:[o],op:function(e,n){var r=this;return new Promise(function(o){setTimeout(function(){o(t.findNext(r,e))},n)})},execute:function(e){return t.unifiedExec(this,e)}}}}),E.addGrammarElement("dotOrColonPath",function(e,t,n){var r=n.matchTokenType("IDENTIFIER");if(r){var o=[r.value],a=n.matchOpToken(".")||n.matchOpToken(":");if(a)do{o.push(n.requireTokenType("IDENTIFIER").value)}while(n.matchOpToken(a.value));return{type:"dotOrColonPath",path:o,evaluate:function(){return o.join(a?a.value:"")}}}}),E.addGrammarElement("eventName",function(e,t,n){var r;return(r=n.matchTokenType("STRING"))?{evaluate:function(){return r.value}}:e.parseElement("dotOrColonPath",n)}),E.addCommand("send",function(e,t,n){if(n.matchToken("send")){var r=e.requireElement("eventName",n),o=e.parseElement("namedArgumentList",n);if(n.matchToken("to"))var a=e.requireElement("expression",n);else a=e.requireElement("implicitMeTarget",n);var i={eventName:r,details:o,to:a,args:[a,r,o],op:function(e,n,r,o){return t.forEach(n,function(e){t.triggerEvent(e,r,o||{})}),t.findNext(i,e)}};return i}});var b=function(e,t,n,r){if(r)var o=e.requireElement("expression",n);var a={value:o,args:[o],op:function(e,n){var r=e.meta.resolve;return e.meta.returned=!0,r?n?r(n):r():(e.meta.returned=!0,e.meta.returnValue=n),t.HALT}};return a};E.addCommand("return",function(e,t,n){if(n.matchToken("return"))return b(e,t,n,!0)}),E.addCommand("exit",function(e,t,n){if(n.matchToken("exit"))return b(e,t,n,!1)}),E.addCommand("halt",function(e,t,n){if(n.matchToken("halt")){if(n.matchToken("the")){n.requireToken("event"),n.matchOpToken("'")&&n.requireToken("s");var r=!0}if(n.matchToken("bubbling"))var o=!0;else if(n.matchToken("default"))var a=!0;var i=b(e,t,n,!1);return{keepExecuting:!0,bubbling:o,haltDefault:a,exit:i,op:function(e){if(e.event)return o?e.event.stopPropagation():(a||e.event.stopPropagation(),e.event.preventDefault()),r?t.findNext(this,e):i}}}}),E.addCommand("log",function(e,t,n){if(n.matchToken("log")){for(var r=[e.parseElement("expression",n)];n.matchOpToken(",");)r.push(e.requireElement("expression",n));if(n.matchToken("with"))var o=e.requireElement("expression",n);var a={exprs:r,withExpr:o,args:[o,r],op:function(e,n,r){return n?n.apply(null,r):console.log.apply(null,r),t.findNext(this,e)}};return a}}),E.addCommand("throw",function(e,t,n){if(n.matchToken("throw")){var r=e.requireElement("expression",n),o={expr:r,args:[r],op:function(e,n){t.registerHyperTrace(e,n);var r=e.meta&&e.meta.reject;if(r)return r(n),t.HALT;throw n}};return o}});var w=function(e,t,n){var r=e.requireElement("expression",n),o={expr:r,args:[r],op:function(e,n){return e.result=n,t.findNext(o,e)}};return o};E.addCommand("call",function(e,t,n){if(n.matchToken("call")){var r=w(e,t,n);return r.expr&&"functionCall"!==r.expr.type&&e.raiseParseError(n,"Must be a function invocation"),r}}),E.addCommand("get",function(e,t,n){if(n.matchToken("get"))return w(e,t,n)}),E.addCommand("make",function(e,t,n){if(n.matchToken("make")){n.matchToken("a")||n.matchToken("an");var r,o=e.requireElement("expression",n),a=[];if("queryRef"!==o.type&&n.matchToken("from"))do{a.push(e.requireElement("expression",n))}while(n.matchOpToken(","));if(n.matchToken("called"))var i=n.requireTokenType("IDENTIFIER").value;return"queryRef"===o.type?r={op:function(e){for(var n,r,a="div",u=[],s=/(?:(^|#|\.)([^#\. ]+))/g;n=s.exec(o.css);)""===n[1]?a=n[2].trim():"#"===n[1]?r=n[2].trim():u.push(n[2].trim());var c=document.createElement(a);void 0!==r&&(c.id=r);for(var l=0;l<u.length;l++)c.classList.add(u[l]);return e.result=c,i&&(e[i]=c),t.findNext(this,e)}}:(r={args:[o,a],op:function(e,n,r){return e.result=p(n,r),i&&(e[i]=e.result),t.findNext(this,e)}},r)}}),E.addGrammarElement("pseudoCommand",function(e,t,n){var r=e.requireElement("primaryExpression",n);if("functionCall"!==r.type&&"symbol"!==r.root.type&&e.raiseParseError(n,"Implicit function calls must start with a simple function"),!n.matchAnyToken("to","on","with","into","from","at")&&e.commandBoundary(n.currentToken()))var o=e.requireElement("implicitMeTarget",n);else o=e.requireElement("expression",n);var a=r.root.name,i={type:"pseudoCommand",expr:r,args:[o,r.argExressions],op:function(e,n,r){var o=n[a];o.hyperfunc&&r.push(e);var u=o.apply(n,r);return e.result=u,t.findNext(i,e)},execute:function(e){return t.unifiedExec(this,e)}};return i});var q=function(e,t,n,r,o){var a="symbol"===r.type,i="attributeRef"===r.type;i||a||null!=r.root||e.raiseParseError(n,"Can only put directly into symbols, not references");var u=null,s=null;if(a);else if(i){u=e.requireElement("implicitMeTarget",n);var c=r}else s=r.prop?r.prop.value:null,c=r.attribute,u=r.root;var l={target:r,symbolWrite:a,value:o,args:[u,o],op:function(e,n,o){return a?t.setSymbol(r.name,e,r.symbolType,o):t.implicitLoop(n,function(e){c?null==o?e.removeAttribute(c.name):e.setAttribute(c.name,o):e[s]=o}),t.findNext(this,e)}};return l};E.addCommand("default",function(e,t,n){if(n.matchToken("default")){var r=e.requireElement("assignableExpression",n);n.requireToken("to");var o=e.requireElement("expression",n),a=q(e,t,n,r,o),i={target:r,value:o,setter:a,args:[r],op:function(e,n){return n?t.findNext(this,e):a}};return a.parent=i,i}}),E.addCommand("set",function(e,t,n){if(n.matchToken("set")){if("L_BRACE"===n.currentToken().type){var r=e.requireElement("objectLiteral",n);n.requireToken("on");var o={objectLiteral:r,target:a=e.requireElement("expression",n),args:[r,a],op:function(e,n,r){return f(r,n),t.findNext(this,e)}};return o}try{n.pushFollow("to");var a=e.requireElement("assignableExpression",n)}finally{n.popFollow()}n.requireToken("to");var i=e.requireElement("expression",n);return q(e,t,n,a,i)}}),E.addCommand("if",function(e,t,n){if(n.matchToken("if")){var r=e.requireElement("expression",n);n.matchToken("then");var o=e.parseElement("commandList",n);if(n.matchToken("else"))var a=e.parseElement("commandList",n);n.hasMore()&&n.requireToken("end");var i={expr:r,trueBranch:o,falseBranch:a,args:[r],op:function(e,n){return n?o:a||t.findNext(this,e)}};return e.setParent(o,i),e.setParent(a,i),i}});var S=function(e,t,n,r){var o,a=t.currentToken();if(t.matchToken("for")||r){var i=t.requireTokenType("IDENTIFIER");o=i.value,t.requireToken("in");var u=e.requireElement("expression",t)}else if(t.matchToken("in"))o="it",u=e.requireElement("expression",t);else if(t.matchToken("while"))var s=e.requireElement("expression",t);else if(t.matchToken("until")){var c=!0;if(t.matchToken("event")){var l=E.requireElement("dotOrColonPath",t,"Expected event name");if(t.matchToken("from"))var f=e.requireElement("expression",t)}else s=e.requireElement("expression",t)}else if(t.matchTokenType("NUMBER")){var m=parseFloat(a.value);t.requireToken("times")}else{t.matchToken("forever");var p=!0}if(t.matchToken("index"))var d=(i=t.requireTokenType("IDENTIFIER")).value;var h=e.parseElement("commandList",t);if(h&&l){for(var v=h;v.next;)v=v.next;var y={type:"waitATick",op:function(){return new Promise(function(e){setTimeout(function(){e(n.findNext(y))},0)})}};v.next=y}if(t.hasMore()&&t.requireToken("end"),null==o)var T=o="_implicit_repeat_"+a.start;else T=o+"_"+a.start;var k={identifier:o,indexIdentifier:d,slot:T,expression:u,forever:p,times:m,until:c,event:l,on:f,whileExpr:s,resolveNext:function(){return this},loop:h,args:[s],op:function(e,t){var r=e.meta.iterators[T],a=!1,i=null;if(this.forever)a=!0;else if(this.until)a=l?!1===e.meta.iterators[T].eventFired:!0!==t;else if(s)a=t;else if(m)a=r.index<this.times;else{var u=r.iterator.next();a=!u.done,i=u.value}return a?(e.result=r.value?e[o]=i:r.index,d&&(e[d]=r.index),r.index++,h):(e.meta.iterators[T]=null,n.findNext(this.parent,e))}};e.setParent(h,k);var g={name:"repeatInit",args:[u,l,f],op:function(e,t,n,r){var o={index:0,value:t,eventFired:!1};return e.meta.iterators[T]=o,t&&t[Symbol.iterator]&&(o.iterator=t[Symbol.iterator]()),l&&(r||e.me).addEventListener(n,function(t){e.meta.iterators[T].eventFired=!0},{once:!0}),k},execute:function(e){return n.unifiedExec(this,e)}};return e.setParent(k,g),g};if(E.addCommand("repeat",function(e,t,n){if(n.matchToken("repeat"))return S(e,n,t,!1)}),E.addCommand("for",function(e,t,n){if(n.matchToken("for"))return S(e,n,t,!0)}),E.addGrammarElement("stringLike",function(e,t,n){return E.parseAnyOf(["string","nakedString"],n)}),E.addCommand("append",function(e,t,n){if(n.matchToken("append")){var r=null,o=null,a=e.requireElement("expression",n);if(n.matchToken("to")&&(r=e.requireElement("expression",n)),null==r)o="result";else if("symbol"===r.type)o=r.name;else{if("propertyAccess"!==r.type)throw"Unable to append to "+r.type;o=r.prop.value}var i={value:a,target:r,args:[a],op:function(e,n){if(Array.isArray(e[o]))e[o].push(n);else if(e[o]instanceof Element){if("string"!=typeof n)throw"Don't know how to append non-strings to an HTML Element yet.";e[o].innerHTML+=n}else e[o]+=n;return t.findNext(this,e)},execute:function(e){return t.unifiedExec(this,e)}};return i}}),E.addCommand("increment",function(e,t,n){if(n.matchToken("increment")){var r,o=e.parseElement("assignableExpression",n);n.matchToken("by")&&(r=e.requireElement("expression",n));var a={target:o,args:[o,r],op:function(r,a,i){var u=(a=a?parseFloat(a):0)+(i=i?parseFloat(i):1),s=q(e,t,n,o,u);return r.result=u,s.parent=this,s},execute:function(e){return t.unifiedExec(this,e)}};return a}}),E.addCommand("decrement",function(e,t,n){if(n.matchToken("decrement")){var r,o=e.parseElement("assignableExpression",n);n.matchToken("by")&&(r=e.requireElement("expression",n));var a={target:o,args:[o,r],op:function(r,a,i){var u=(a=a?parseFloat(a):0)-(i=i?parseFloat(i):1),s=q(e,t,n,o,u);return r.result=u,s.parent=this,s},execute:function(e){return t.unifiedExec(this,e)}};return a}}),E.addCommand("fetch",function(e,t,n){if(n.matchToken("fetch")){var r,o=e.requireElement("stringLike",n),a=e.parseElement("objectLiteral",n),i="text";n.matchToken("as")&&(n.matchToken("json")?i="json":n.matchToken("response")?i="response":n.matchToken("html")?i="html":n.matchToken("text")||(r=e.requireElement("dotOrColonPath",n).evaluate()));var u={url:o,argExpressions:a,args:[o,a],op:function(e,n,o){return fetch(n,o).then(function(n){return"response"===i?(e.result=n,t.findNext(u,e)):"json"===i?n.json().then(function(n){return e.result=n,t.findNext(u,e)}):n.text().then(function(n){return r&&(n=t.convertValue(n,r)),"html"===i&&(n=t.convertValue(n,"Fragment")),e.result=n,t.findNext(u,e)})}).catch(function(n){throw t.triggerEvent(e.me,"fetch:error",{reason:n}),n})}};return u}}),"document"in d){var O=Array.from(document.querySelectorAll("script[type='text/hyperscript'][src]"));Promise.all(O.map(function(e){return fetch(e.src).then(function(e){return e.text()}).then(function(e){return T.evaluate(e)})})).then(function(){var e;e=function(){var e,t;(t=(e=document.querySelector('meta[name="htmx-config"]'))?function(e){try{return JSON.parse(e)}catch(e){return t=e,console.error?console.error(t):console.log&&console.log("ERROR: ",t),null}var t}(e.content):null)&&(l.config=f(l.config,t)),T.processNode(document.documentElement),document.addEventListener("htmx:load",function(e){T.processNode(e.detail.elt)})},"loading"!==document.readyState?setTimeout(e):document.addEventListener("DOMContentLoaded",e)})}var N=l=f(function(e,t){return T.evaluate(e,t)},{internals:{lexer:v,parser:E,runtime:T},ElementCollection:h,addFeature:function(e,t){E.addFeature(e,t)},addCommand:function(e,t){E.addCommand(e,t)},addLeafExpression:function(e,t){E.addLeafExpression(e,t)},addIndirectExpression:function(e,t){E.addIndirectExpression(e,t)},evaluate:T.evaluate.bind(T),parse:T.parse.bind(T),processNode:T.processNode.bind(T),config:{attributes:"_, script, data-script",defaultTransition:"all 500ms ease-in",disableSelector:"[disable-scripting], [data-disable-scripting]",conversions:y}});N.addCommand("settle",function(e,t,n){if(n.matchToken("settle")){if(e.commandBoundary(n.currentToken()))r=e.requireElement("implicitMeTarget",n);else var r=e.requireElement("expression",n);var o={type:"settleCmd",args:[r],op:function(e,n){var r=null,a=!1,i=new Promise(function(e){r=e});return n.addEventListener("transitionstart",function(){a=!0},{once:!0}),setTimeout(function(){a||r(t.findNext(o,e))},500),n.addEventListener("transitionend",function(){r(t.findNext(o,e))},{once:!0}),i},execute:function(e){return t.unifiedExec(this,e)}};return o}}),N.addCommand("add",function(e,t,n){if(n.matchToken("add")){var r=e.parseElement("classRef",n),o=null,a=null;if(null==r)null==(o=e.parseElement("attributeRef",n))&&null==(a=e.parseElement("styleLiteral",n))&&e.raiseParseError(n,"Expected either a class reference or attribute expression");else for(var i=[r];r=e.parseElement("classRef",n);)i.push(r);if(n.matchToken("to"))var u=e.requireElement("expression",n);else u=e.parseElement("implicitMeTarget",n);return i?{classRefs:i,to:u,args:[u,i],op:function(e,n,r){return t.forEach(r,function(e){t.forEach(n,function(t){t instanceof Element&&t.classList.add(e.className)})}),t.findNext(this,e)}}:o?{type:"addCmd",attributeRef:o,to:u,args:[u],op:function(e,n,r){return t.forEach(n,function(e){e.setAttribute(o.name,o.value)}),t.findNext(this,e)},execute:function(e){return t.unifiedExec(this,e)}}:{type:"addCmd",cssDeclaration:a,to:u,args:[u,a],op:function(e,n,r){return t.forEach(n,function(e){e.style.cssText+=r}),t.findNext(this,e)},execute:function(e){return t.unifiedExec(this,e)}}}}),N.internals.parser.addGrammarElement("styleLiteral",function(e,t,n){if(n.matchOpToken("{")){for(var r=[""],o=[];n.hasMore();){if(n.matchOpToken("\\"))n.consumeToken();else{if(n.matchOpToken("}"))break;if(n.matchToken("$")){var a=n.matchOpToken("{"),i=e.parseElement("expression",n);a&&n.requireOpToken("}"),o.push(i),r.push("")}else{var u=n.consumeToken();r[r.length-1]+=n.source.substring(u.start,u.end)}}r[r.length-1]+=n.lastWhitespace()}return{type:"styleLiteral",args:[o],op:function(e,t){var n="";return r.forEach(function(e,r){n+=e,r in t&&(n+=t[r])}),n},evaluate:function(e){return t.unifiedEval(this,e)}}}}),N.addCommand("remove",function(e,t,n){if(n.matchToken("remove")){var r=e.parseElement("classRef",n),o=null,a=null;if(null==r)null==(o=e.parseElement("attributeRef",n))&&null==(a=e.parseElement("expression",n))&&e.raiseParseError(n,"Expected either a class reference, attribute expression or value expression");else for(var i=[r];r=e.parseElement("classRef",n);)i.push(r);if(n.matchToken("from"))var u=e.requireElement("expression",n);else u=e.requireElement("implicitMeTarget",n);return a?{elementExpr:a,from:u,args:[a],op:function(e,n){return t.forEach(n,function(e){e.parentElement&&e.parentElement.removeChild(e)}),t.findNext(this,e)}}:{classRefs:i,attributeRef:o,elementExpr:a,from:u,args:[i,u],op:function(e,n,r){return n?t.forEach(n,function(e){t.implicitLoop(r,function(t){t.classList.remove(e.className)})}):t.forEach(r,function(e){e.removeAttribute(o.name)}),t.findNext(this,e)}}}}),N.addCommand("toggle",function(e,t,n){if(n.matchToken("toggle")){if(n.matchToken("between")){var r=!0,o=e.parseElement("classRef",n);n.requireToken("and");var a=e.requireElement("classRef",n)}else{o=e.parseElement("classRef",n);var i=null;if(null==o)null==(i=e.parseElement("attributeRef",n))&&e.raiseParseError(n,"Expected either a class reference or attribute expression");else for(var u=[o];o=e.parseElement("classRef",n);)u.push(o)}if(n.matchToken("on"))var s=e.requireElement("expression",n);else s=e.requireElement("implicitMeTarget",n);if(n.matchToken("for"))var c=e.requireElement("timeExpression",n);else if(n.matchToken("until")){var l=e.requireElement("dotOrColonPath",n,"Expected event name");if(n.matchToken("from"))var f=e.requireElement("expression",n)}var m={classRef:o,classRef2:a,classRefs:u,attributeRef:i,on:s,time:c,evt:l,from:f,toggle:function(e,n,o,a){r?t.forEach(e,function(e){e.classList.contains(n.className)?(e.classList.remove(n.className),e.classList.add(o.className)):(e.classList.add(n.className),e.classList.remove(o.className))}):a?t.forEach(a,function(n){t.forEach(e,function(e){e.classList.toggle(n.className)})}):t.forEach(e,function(e){e.hasAttribute(i.name)?e.removeAttribute(i.name):e.setAttribute(i.name,i.value)})},args:[s,c,l,f,o,a,u],op:function(e,n,r,o,a,i,u,s){return r?new Promise(function(o){m.toggle(n,i,u,s),setTimeout(function(){m.toggle(n,i,u,s),o(t.findNext(m,e))},r)}):o?new Promise(function(r){(a||e.me).addEventListener(o,function(){m.toggle(n,i,u,s),r(t.findNext(m,e))},{once:!0}),m.toggle(n,i,u,s)}):(this.toggle(n,i,u,s),t.findNext(m,e))}};return m}});var I={display:function(e,t,n){t.style.display=n||("hide"===e?"none":"block")},visibility:function(e,t,n){t.style.visibility=n||("hide"===e?"hidden":"visible")},opacity:function(e,t,n){t.style.opacity=n||("hide"===e?"0":"1")}},L=function(e,t,n){var r=n.currentToken();return"with"===r.value||e.commandBoundary(r)?e.parseElement("implicitMeTarget",n):e.parseElement("expression",n)},C=function(e,t,n){var r=N.config.defaultHideShowStrategy,o=I;N.config.hideShowStrategies&&(o=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(o,N.config.hideShowStrategies));var a=o[n=n||r||"display"];return null==a&&e.raiseParseError(t,"Unknown show/hide strategy : "+n),a};function R(e,t,n){if(t)var r=e[t];else r=e;if(r instanceof Element||r instanceof HTMLDocument){for(;r.firstChild;)r.removeChild(r.firstChild);r.append(N.internals.runtime.convertValue(n,"Fragment"))}else{if(!t)throw"Don't know how to put a value into "+typeof e;e[t]=n}}function A(e,t,n){var r;if(n.matchToken("the")||n.matchToken("element")||n.matchToken("elements")||"CLASS_REF"===n.currentToken().type||"ID_REF"===n.currentToken().type||n.currentToken().op&&"<"===n.currentToken().value){e.possessivesDisabled=!0;try{r=e.parseElement("expression",n)}finally{delete e.possessivesDisabled}n.matchOpToken("'")&&n.requireToken("s")}else if("IDENTIFIER"===n.currentToken().type&&"its"===n.currentToken().value){var o=n.matchToken("its");r={type:"pseudopossessiveIts",token:o,name:o.value,evaluate:function(e){return t.resolveSymbol("it",e)}}}else n.matchToken("my")||n.matchToken("me"),r=e.parseElement("implicitMeTarget",n);return r}N.addCommand("hide",function(e,t,n){if(n.matchToken("hide")){var r=L(e,0,n),o=null;n.matchToken("with")&&(o=n.requireTokenType("IDENTIFIER").value);var a=C(e,n,o);return{target:r,args:[r],op:function(e,n){return t.forEach(n,function(e){a("hide",e)}),t.findNext(this,e)}}}}),N.addCommand("show",function(e,t,n){if(n.matchToken("show")){var r=L(e,0,n),o=null;n.matchToken("with")&&(o=n.requireTokenType("IDENTIFIER").value);var a=null;if(n.matchOpToken(":")){var i=n.consumeUntilWhitespace();n.matchTokenType("WHITESPACE"),a=i.map(function(e){return e.value}).join("")}var u=C(e,n,o);return{target:r,args:[r],op:function(e,n){return t.forEach(n,function(e){u("show",e,a)}),t.findNext(this,e)}}}}),N.addCommand("trigger",function(e,t,n){if(n.matchToken("trigger")){var r=e.requireElement("eventName",n),o=e.parseElement("namedArgumentList",n),a={eventName:r,details:o,args:[r,o],op:function(e,n,r){return t.triggerEvent(e.me,n,r||{}),t.findNext(a,e)}};return a}}),N.addCommand("take",function(e,t,n){if(n.matchToken("take")){var r=e.parseElement("classRef",n);if(n.matchToken("from"))var o=e.requireElement("expression",n);else o=r;if(n.matchToken("for"))var a=e.requireElement("expression",n);else a=e.requireElement("implicitMeTarget",n);var i={classRef:r,from:o,forElt:a,args:[r,o,a],op:function(e,n,r,o){var a=n.className;return t.forEach(r,function(e){e.classList.remove(a)}),t.forEach(o,function(e){e.classList.add(a)}),t.findNext(this,e)}};return i}}),N.addCommand("put",function(e,t,n){if(n.matchToken("put")){var r=e.requireElement("expression",n),o=n.matchAnyToken("into","before","after");null==o&&n.matchToken("at")&&(n.matchToken("the"),o=n.matchAnyToken("start","end"),n.requireToken("of")),null==o&&e.raiseParseError(n,"Expected one of 'into', 'before', 'at start of', 'at end of', 'after'");var a=e.requireElement("expression",n),i=o.value,u=!1,s=null,c=null;if("propertyAccess"===a.type&&"into"===i)c=a.prop.value,s=a.root;else if("symbol"===a.type&&"into"===i)u=!0,c=a.name;else if("attributeRef"===a.type&&"into"===i){var l=!0;c=a.name,s=e.requireElement("implicitMeTarget",n)}else"attributeRefAccess"===a.type&&"into"===i?(l=!0,c=a.attribute.name,s=a.root):s=a;var f={target:a,operation:i,symbolWrite:u,value:r,args:[s,r],op:function(e,n,r){if(u)R(e,c,r);else if("into"===i)t.implicitLoop(n,l?function(e){e.setAttribute(c,r)}:function(e){R(e,c,r)});else{var o="before"===i?Element.prototype.before:"after"===i?Element.prototype.after:"start"===i?Element.prototype.prepend:Element.prototype.append;t.implicitLoop(n,function(e){o.call(e,r instanceof Node?r:t.convertValue(r,"Fragment"))})}return t.findNext(this,e)}};return f}}),N.addCommand("transition",function(e,t,n){if(n.matchToken("transition")){for(var r=A(e,t,n),o=[],a=[],i=[],u=n.currentToken();!e.commandBoundary(u)&&"over"!==u.value&&"using"!==u.value;)o.push(e.requireElement("stringLike",n)),n.matchToken("from")?a.push(e.requireElement("stringLike",n)):a.push(null),n.requireToken("to"),i.push(e.requireElement("stringLike",n)),u=n.currentToken();if(n.matchToken("over"))var s=e.requireElement("timeExpression",n);else if(n.matchToken("using"))var c=e.requireElement("expression",n);var l={to:i,args:[r,o,a,i,c,s],op:function(e,n,r,o,a,i,u){var s=[];return t.forEach(n,function(e){var n=new Promise(function(n,s){var c=e.style.transition;e.style.transition=u?"all "+u+"ms ease-in":i||N.config.defaultTransition;for(var l=t.getInternalData(e),f=getComputedStyle(e),m={},p=0;p<f.length;p++){var d=f[p];m[d]=f[d]}for(l.initalStyles||(l.initalStyles=m),p=0;p<r.length;p++){var h=r[p],v=o[p];e.style[h]="computed"==v||null==v?m[h]:v}setTimeout(function(){for(var t=0;t<r.length;t++){var o=r[t],i=a[t];e.style[o]="initial"==i?l.initalStyles[o]:i}e.addEventListener("transitionend",function(){e.style.transition=c,n()},{once:!0})},5)});s.push(n)}),Promise.all(s).then(function(){return t.findNext(l,e)})}};return l}}),N.addCommand("measure",function(e,t,n){if(n.matchToken("measure")){var r=A(e,t,n),o=[];if(!e.commandBoundary(n.currentToken()))do{o.push(n.matchTokenType("IDENTIFIER").value)}while(n.matchOpToken(","));return{properties:o,args:[r],op:function(e,n){0 in n&&(n=n[0]);var r=n.getBoundingClientRect(),a={top:n.scrollTop,left:n.scrollLeft,topMax:n.scrollTopMax,leftMax:n.scrollLeftMax,height:n.scrollHeight,width:n.scrollWidth};return e.result={x:r.x,y:r.y,left:r.left,top:r.top,right:r.right,bottom:r.bottom,width:r.width,height:r.height,bounds:r,scrollLeft:a.left,scrollTop:a.top,scrollLeftMax:a.leftMax,scrollTopMax:a.topMax,scrollWidth:a.width,scrollHeight:a.height,scroll:a},t.forEach(o,function(t){if(!(t in e.result))throw"No such measurement as "+t;e[t]=e.result[t]}),t.findNext(this,e)}}}}),N.addLeafExpression("closestExpr",function(e,t,n){if(n.matchToken("closest")){if(n.matchToken("parent"))var r=!0;var o=null;if("ATTRIBUTE_REF"===n.currentToken().type){var a=e.parseElement("attributeRefAccess",n,null);o="["+a.attribute.name+"]"}if(null==o){var i=e.parseElement("expression",n);null==i.css?e.raiseParseError(n,"Expected a CSS expression"):o=i.css}if(n.matchToken("to"))var u=e.parseElement("expression",n);else u=e.parseElement("implicitMeTarget",n);var s={type:"closestExpr",parentSearch:r,expr:i,css:o,to:u,args:[u],op:function(e,t){if(null!=t&&t instanceof Element){if(r)var n=t.parentElement?t.parentElement.closest(o):null;else n=t.closest(o);return n}return null},evaluate:function(e){return t.unifiedEval(this,e)}};return a?(a.root=s,a.args=[s],a):s}}),N.addCommand("go",function(e,t,n){if(n.matchToken("go")){if(n.matchToken("back"))var r=!0;else if(n.matchToken("to"),n.matchToken("url")){var o=e.requireElement("stringLike",n),a=!0;if(n.matchToken("in")){n.requireToken("new"),n.requireToken("window");var i=!0}}else{n.matchToken("the");var u=n.matchAnyToken("top","bottom","middle"),s=n.matchAnyToken("left","center","right");(u||s)&&n.requireToken("of"),o=e.requireElement("expression",n);var c=n.matchAnyToken("smoothly","instantly"),l={};u&&("top"===u.value?l.block="start":"bottom"===u.value?l.block="end":"middle"===u.value&&(l.block="center")),s&&("left"===s.value?l.inline="start":"center"===s.value?l.inline="center":"right"===s.value&&(l.inline="end")),c&&("smoothly"===c.value?l.behavior="smooth":"instantly"===c.value&&(l.behavior="instant"))}var f={target:o,args:[o],op:function(e,n){return r?window.history.back():a?n&&(0!==n.indexOf("#")||i?window.open(n,i?"_blank":null):window.location.href=n):t.forEach(n,function(e){e.scrollIntoView(l)}),t.findNext(f)}};return f}}),N.config.conversions.Values=function(e){var t={};return(0,N.internals.runtime.implicitLoop)(e,function(e){var o=r(e);void 0===o?null!=e.querySelectorAll&&e.querySelectorAll("input,select,textarea").forEach(n):t[o.name]=o.value}),t;function n(e){var n=r(e);null!=n&&(null!=t[n.name]?Array.isArray(t[n.name])&&Array.isArray(n.value)&&(t[n.name]=[].concat(t[n.name],n.value)):t[n.name]=n.value)}function r(e){try{var t={name:e.name,value:e.value};if(null==t.name||null==t.value)return;if("radio"==e.type&&0==e.checked)return;if("checkbox"==e.type&&(0==e.checked?t.value=void 0:"string"==typeof t.value&&(t.value=[t.value])),"select-multiple"==e.type){var n=e.querySelectorAll("option[selected]");t.value=[];for(var r=0;r<n.length;r++)t.value.push(n[r].value)}return t}catch(e){return}}},N.config.conversions.HTML=function(e){return function e(t){if(t instanceof Array)return t.map(function(t){return e(t)}).join("");if(t instanceof HTMLElement)return t.outerHTML;if(t instanceof NodeList){for(var n="",r=0;r<t.length;r++){var o=t[r];o instanceof HTMLElement&&(n+=o.outerHTML)}return n}return t.toString?t.toString():""}(e)},N.config.conversions.Fragment=function(e){var t=document.createDocumentFragment();return N.internals.runtime.implicitLoop(e,function(e){if(e instanceof Node)t.append(e);else{var n=document.createElement("template");n.innerHTML=e,t.append(n.content)}}),t};var F=0,P="("+function(){self.onmessage=function(e){switch(e.data.type){case"init":importScripts(e.data._hyperscript),importScripts.apply(self,e.data.extraScripts);var t=N.internals.lexer.makeTokensObject(e.data.tokens,[],e.data.source);N.internals.parser.parseElement("hyperscript",t).apply(self),postMessage({type:"didInit"});break;case"call":try{var n=self[e.data.function].apply(self,e.data.args);Promise.resolve(n).then(function(t){postMessage({type:"resolve",id:e.data.id,value:t})}).catch(function(t){postMessage({type:"reject",id:e.data.id,error:t.toString()})})}catch(t){postMessage({type:"reject",id:e.data.id,error:t.toString()})}}}}.toString()+")()",M=new Blob([P],{type:"text/javascript"}),j=URL.createObjectURL(M);function _(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function D(e){return new WebSocket(e.evaluate())}N.addFeature("worker",function(e,t,n){if(n.matchToken("worker")){var r=e.requireElement("dotOrColonPath",n).evaluate().split("."),o=r.pop(),a=[];if(n.matchOpToken("("))if(n.matchOpToken(")"));else{do{var i=n.requireTokenType("STRING").value,u=new URL(i,location.href).href;a.push(u)}while(n.matchOpToken(","));n.requireOpToken(")")}var s=[],c=n.consumed.length,l=n.consumed.length;do{var f=e.parseAnyOf(["defFeature","jsFeature"],n);if(!f)break;if("defFeature"===f.type)s.push(f.name),l=n.consumed.length;else if(n.hasMore())continue}while(n.matchToken("end")&&n.hasMore());var m=n.consumed.slice(c,l+1),p=new Worker(j,{type:"module"});p.postMessage({type:"init",_hyperscript:t.hyperscriptUrl,extraScripts:a,tokens:m,source:n.source});var d=new Promise(function(e,t){p.addEventListener("message",function(t){"didInit"===t.data.type&&e()},{once:!0})}),h={};return s.forEach(function(e){h[e]=function(){var t=arguments;return new Promise(function(n,r){var o=F++;p.addEventListener("message",function e(t){t.data.id===o&&(p.removeEventListener("message",e),"resolve"===t.data.type?n(t.data.value):r(t.data.error))}),d.then(function(){p.postMessage({type:"call",function:e,args:Array.from(t),id:o})})})}}),{name:o,worker:p,install:function(e){t.assignToNamespace(e,r,o,h)}}}});var H=["then","catch","length","asyncWrapper","toJSON"];function U(e){return e.replace(/(?:^|\n)([^@]*)@?/gm,function(e,t){return"\ncall __ht_template_result.push(`"+(" "+t).replace(/([^\\])\$\{/g,"$1$${escape html ").substring(1)+"`)\n"})}function B(e,t,n){this.ctx=e,this.runtime=t,this.cmd=n,this._hyperscript=N,this.bus=new EventTarget}return N.addFeature("socket",function(e,t,n){if(n.matchToken("socket")){var r=e.requireElement("dotOrColonPath",n).evaluate().split("."),o=r.pop(),a={},i=e.requireElement("stringLike",n),u=1e4;if(n.matchToken("with")&&(n.requireToken("timeout"),u=e.requireElement("timeExpression",n).evaluate()),n.matchToken("on")){if(n.requireToken("message"),n.matchToken("as")){n.requireToken("json");var s=!0}for(var c=e.requireElement("commandList",n),l={type:"implicitReturn",op:function(e){return t.HALT},execute:function(e){}},f=c;f.next;)f=f.next;f.next=l}var m=D(i),p=function e(t){return new Proxy({},{get:function(n,r){return H.indexOf(r)>=0?null:"noTimeout"===r?e(-1):"timeout"===r?function(t){return e(parseInt(t))}:function(){for(var e=_(),n=[],o=0;o<arguments.length;o++)n.push(arguments[o]);var u={iid:e,function:r,args:n};(m=m||D(i)).send(JSON.stringify(u));var s=new Promise(function(t,n){a[e]={resolve:t,reject:n}});return t>=0&&setTimeout(function(){a[e]&&a[e].reject("Timed out"),delete a[e]},t),s}}})}(u),d={raw:m,dispatchEvent:function(e){var t=e.detail;delete t.sentBy,delete t._namedArgList_,m.send(JSON.stringify(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}({type:e.type},t)))},rpc:p},h={name:o,socket:d,install:function(e){t.assignToNamespace(e,r,o,d)}};return m.onmessage=function(e){var n=e.data;try{var r=JSON.parse(n)}catch(e){}if(r&&r.iid&&(r.throw?a[r.iid].reject(r.throw):a[r.iid].resolve(r.return),delete a[r.iid]),c){var o=t.makeContext(d,h,d);if(s){if(!r)throw"Received non-JSON message from socket: "+n;o.message=r,o.result=r}else o.message=n,o.result=n;c.execute(o)}},m.addEventListener("close",function(e){m=null}),h}}),N.addFeature("eventsource",function(e,t,n){if(n.matchToken("eventsource")){var r,o=function(e,n){return function(r){var o=a(r.data,e),i=t.makeContext(l,f,l);i.event=r,i.result=o,n.execute(i)}},a=function(e,t){return"json"==t?JSON.parse(e):e},i=function e(n){if(n.next)return e(n.next);n.next={type:"implicitReturn",op:function(e){return t.HALT},execute:function(e){}}},u=!1,s=e.requireElement("dotOrColonPath",n).evaluate().split("."),c=s.pop();n.matchToken("from")&&(r=e.requireElement("stringLike",n)),n.matchToken("with")&&n.matchToken("credentials")&&(u=!0);for(var l={eventSource:null,listeners:[],retryCount:0,open:function(e){if(null==e){if(null==l.eventSource||null==l.eventSource.url)throw"no url defined for EventSource.";e=l.eventSource.url}if(null!=l.eventSource)if(e!=l.eventSource.url)l.eventSource.close();else if(l.eventSource.readyState!=EventSource.CLOSED)return;l.eventSource=new EventSource(e,{withCredentials:u}),l.eventSource.addEventListener("open",function(e){l.retryCount=0}),l.eventSource.addEventListener("error",function(e){if(l.eventSource.readyState==EventSource.CLOSED){l.retryCount=Math.min(7,l.retryCount+1);var t=Math.random()*(2^l.retryCount)*500;window.setTimeout(l.open,t)}});for(var t=0;t<l.listeners.length;t++){var n=l.listeners[t];l.eventSource.addEventListener(n.type,n.handler,n.options)}},close:function(){null!=l.eventSource&&l.eventSource.close(),l.retryCount=0},addEventListener:function(e,t,n){l.listeners.push({type:e,handler:t,options:n}),null!=l.eventSource&&l.eventSource.addEventListener(e,t,n)}},f={name:c,object:l,install:function(e){t.assignToNamespace(e,s,c,l)}};n.matchToken("on");){var m=e.requireElement("stringLike",n,"Expected event name").evaluate(),p="";n.matchToken("as")&&(p=e.requireElement("stringLike",n,"Expected encoding type").evaluate());var d=e.requireElement("commandList",n);i(d),n.requireToken("end"),l.listeners.push({type:m,handler:o(p,d)})}return n.requireToken("end"),null!=r&&l.open(r.evaluate()),f}}),N.addCommand("render",function(e,t,n){if(n.matchToken("render")){var r=e.requireElement("expression",n),o={};return n.matchToken("with")&&(o=e.parseElement("namedArgumentList",n)),{args:[r,o],op:function(e,n,o){if(!(n instanceof Element))throw new Error(r.sourceFor()+" is not an element");return console.log(U(n.innerHTML)),e.result=function(e,t){var n=[];return N(e,Object.assign({__ht_template_result:n},t)),n.join("")}(U(n.innerHTML),o),t.findNext(this,e)}}}}),N.addLeafExpression("escape",function(e,t,n){if(n.matchToken("escape")){var r=n.matchTokenType("IDENTIFIER").value,o=n.matchToken("unescaped");return{args:[e.requireElement("expression",n)],op:function(e,t){if(o)return t;if(void 0===t)return"";if("html"===r)return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\x22/g,"&quot;").replace(/\x27/g,"&#039;");throw new Error("Unknown escape: "+r)},evaluate:function(e){return t.unifiedEval(this,e)}}}}),N.addCommand("breakpoint",function(e,t,n){var r;if(n.matchToken("breakpoint"))return{op:function(e){globalThis.hdb=r=new B(e,t,this);try{return r.break(e)}catch(e){console.error(e,e.stack)}}}}),B.prototype.break=function(e){var t=this;return console.log("=== HDB///_hyperscript/debugger ==="),t.ui(),new Promise(function(n,r){t.bus.addEventListener("continue",function(){if(t.ctx!==e){for(var r in e)delete e[r];Object.assign(e,t.ctx)}delete globalThis.hdb,n(t.runtime.findNext(t.cmd,t.ctx))},{once:!0})})},B.prototype.continueExec=function(){this.bus.dispatchEvent(new Event("continue"))},B.prototype.stepOver=function(){var e=this;if(!e.cmd)return e.continueExec();var t=e.cmd&&"breakpointCommand"===e.cmd.type?e.runtime.findNext(e.cmd,e.ctx):e.runtime.unifiedEval(e.cmd,e.ctx);return"implicitReturn"===t.type?e.stepOut():t&&t.then instanceof Function?t.then(function(t){e.cmd=t,e.bus.dispatchEvent(new Event("step")),e.logCommand()}):void(t.halt_flag?this.bus.dispatchEvent(new Event("continue")):(e.cmd=t,e.bus.dispatchEvent(new Event("step")),this.logCommand()))},B.prototype.stepOut=function(){var e=this;if(!e.ctx.meta.caller)return e.continueExec();var t=e.ctx.meta.callingCommand,n=e.ctx.me;e.ctx=e.ctx.meta.caller,console.log("[hdb] cstepping out into "+e.ctx.meta.feature.displayName),e.ctx.me instanceof Element&&e.ctx.me!==n&&console.log("[hdb] me: ",e.ctx.me),e.cmd=e.runtime.findNext(t,e.ctx),e.cmd=e.runtime.findNext(e.cmd,e.ctx),e.logCommand(),e.bus.dispatchEvent(new Event("step"))},B.prototype.logCommand=function(){var e=this.cmd.sourceFor instanceof Function?this.cmd.sourceFor():"-- "+this.cmd.type;console.log("[hdb] current command: "+e)},B.prototype.ui=function(){var e=document.createElement("div"),t=e.attachShadow({mode:"open"});e.style="all: initial",t.innerHTML='\n<div class="hdb" _="\non load or step from hdb.bus send update to me\non continue from hdb.bus log \'done\' then remove me.getRootNode().host">\n\n<script type="text/hyperscript">\n\ndef escapeHTML(unsafe)\n\tjs(unsafe) return unsafe\n\t\t.replace(/&/g, "&amp;")\n\t\t.replace(/</g, "&lt;")\n\t\t.replace(/>/g, "&gt;")\n\t\t.replace(/\\x22/g, "&quot;")\n\t\t.replace(/\\x27/g, "&#039;") end\n\treturn it\nend\n\ndef highlightDebugCode\n\tset start to hdb.cmd.startToken.start\n\tset end to hdb.cmd.endToken.end\n\tset src to hdb.cmd.programSource\n\tset beforeCmd to \'<code>\'+escapeHTML(src.substring(0, start))+\'</code>\'\n\tset cmd to escapeHTML(src.substring(start, end))\n\tset afterCmd to \'<code>\'+escapeHTML(src.substring(end))+\'</code>\'\n\treturn beforeCmd+"<u class=\'current\'><code>"+cmd+"</code></u>"+afterCmd\nend\n\ndef truncate(str, len)\n\tif str.length <= len return str end\n\treturn str.substr(0, len) + \'\'\n\ndef prettyPrint(obj)\n\tif obj is null      return \'null\'      end\n\tif Element.prototype.isPrototypeOf(obj)\n\t\tset rv to \'&lt;<span class="token tagname">\' +\n\t\t\tobj.tagName.toLowerCase() + "</span>"\n\t\tfor attr in Array.from(obj.attributes)\n\t\t\tif attr.specified\n\t\t\t\tset rv to rv +\n\t\t\t\t\t\' <span class="token attr">\' + attr.nodeName +\n\t\t\t\t\t\'</span>=<span class="token string">"\' + truncate(attr.textContent, 10) +\n\t\t\t\t\t\'"</span>\'\n\t\t\tend\n\t\tend\n\t\tset rv to rv + \'>\'\n\t\treturn rv\n\telse if obj.call\n\t\tif obj.hyperfunc\n\t\t\tget "def " + obj.hypername + \' ...\'\n\t\telse\n\t\t\tget "function "+obj.name+"(...) {...}"\n\t\tend\n\telse if obj.toString\n\t\tcall obj.toString()\n\tend\n\treturn escapeHTML((it or \'undefined\').trim())\nend\n<\/script>\n\n<header _="\non pointerdown(clientX, clientY)\n\thalt the event\n\tcall event.stopPropagation()\n\tget closest .hdb\n\tmeasure its x, y\n\tset xoff to clientX - x\n\tset yoff to clientY - y\n\trepeat until event pointerup from document\n\t\twait for pointermove or pointerup from document\n\t\tadd {\n\t\t\tleft: ${its clientX - xoff}px;\n\t\t\ttop:  ${its clientY - yoff}px;\n\t\t} to .hdb\n\tend\n">\n\t<h2 class="titlebar">HDB</h2>\n\t<ul role="toolbar" class="toolbar" _="on pointerdown halt">\n\t\t<li><button _="on click call hdb.continueExec()">\n\t\t\t&#x23F5; Continue\n\t\t</button>\n\t\t<li><button _="on click call hdb.stepOver()">\n\t\t\t&#8631; Step Over\n\t\t</button>\n\t</ul>\n</header>\n\n<section class="sec-code">\n\n\t<div class="code-container">\n\t\t<pre class="code language-hyperscript" _="\n\t\t\ton update from .hdb if hdb.cmd.programSource\n\t\t\t\tput highlightDebugCode() into me\n\t\t\t\tif Prism\n\t\t\t\t\tcall Prism.highlightAllUnder(me)\n\t\t\t\tend\n\t\t\t\tscrollIntoView({ block: \'nearest\' }) the\n\t\t\t\t\tfirst .current in me"><code></code></pre>\n\t</div>\n</section>\n\n<section class="sec-console" _="\n\t-- Print context at startup\n\tinit repeat for var in Object.keys(hdb.ctx) if var is not \'meta\'\n\t\tsend hdbUI:consoleEntry(input: var, output: hdb.ctx[var]) to #console">\n\n\t<ul id="console" role="list" _="\n\t\ton hdbUI:consoleEntry(input, output)\n\t\t\tif no hdb.consoleHistory set hdb.consoleHistory to [] end\n\t\t\tpush(input) on hdb.consoleHistory\n\t\t\tset node to #tmpl-console-entry.content.cloneNode(true)\n\t\t\tput the node at end of me\n\t\t\tset entry to my lastElementChild\n\t\t\tscrollIntoView({ block: \'end\' }) the entry\n\t\t\tput escapeHTML(input) into .input in the entry\n\t\t\tif no output\n\t\t\t\tcall hdb._hyperscript.internals.runtime.parse(input)\n\t\t\t\tif its execute is not undefined then execute(hdb.ctx) it\n\t\t\t\telse evaluate(hdb.ctx) it\n\t\t\t\tend\n\t\t\t\tset output to it\n\t\t\tend\n\t\t\tput prettyPrint(output) as Fragment into .output in the entry\n\t\t">\n\t\t<template id="tmpl-console-entry">\n\t\t\t<li class="console-entry">\n\t\t\t\t<kbd><code class="input"></code></kbd>\n\t\t\t\t<samp class="output"></samp>\n\t\t\t</li>\n\t\t</template>\n\t</ul>\n\n\t<form id="console-form" data-hist="0" _="on submit\n\t\t\tsend hdbUI:consoleEntry(input: #console-input\'s value) to #console\n\t\t\tset #console-input\'s value to \'\'\n\t\t\tset @data-hist to 0\n\t\t\tset element oldContent to null\n\t\t\thalt\n\t\ton keydown[key is \'ArrowUp\' or key is \'ArrowDown\']\n\t\t\tif no hdb.consoleHistory or exit end\n\t\t\tif element oldContent is null set element oldContent to #console-input.value end\n\t\t\tif event.key is \'ArrowUp\' and hdb.consoleHistory.length > -@data-hist\n\t\t\t\tdecrement @data-hist\n\t\t\telse if event.key is \'ArrowDown\' and @data-hist < 0\n\t\t\t\tincrement @data-hist\n\t\t\tend end\n\t\t\tset #console-input.value to hdb.consoleHistory[hdb.consoleHistory.length + @data-hist as Int]\n\t\t\t\tor oldContent\n\t\t\thalt default\n\t\ton input if @data-hist is \'0\' set element oldContent to #console-input.value">\n\t\t<input id="console-input" placeholder="Enter an expression&hellip;"\n\t\t\tautocomplete="off">\n\t</form>\n</section>\n\n<style>\n.hdb {\n\tborder: 1px solid #888;\n\tborder-radius: .3em;\n\tbox-shadow: 0 .2em .3em #0008;\n\tposition: fixed;\n\ttop: .5em; right: .5em;\n\twidth: min(40ch, calc(100% - 1em));\n\tmax-height: calc(100% - 1em);\n\tbackground-color: white;\n\tfont-family: sans-serif;\n\topacity: .9;\n\tz-index: 2147483647;\n\tcolor: black;\n\tdisplay: flex;\n\tflex-flow: column;\n}\n\n* {\n\tbox-sizing: border-box;\n}\n\nheader {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tpadding: .4em;\n}\n\n.titlebar {\n\tmargin: 0;\n\tfont-size: 1em;\n\ttouch-action: none;\n}\n\n.toolbar {\n\tdisplay: flex;\n\tgap: .35em;\n\n\tlist-style: none;\n\tpadding-left: 0;\n\tmargin: 0;\n}\n\n.toolbar a, .toolbar button {\n\tbackground: #2183ff;\n\tborder: 1px solid #3465a4;\n\tbox-shadow: 0 1px #b3c6ff inset, 0 .06em .06em #000;\n\tborder-radius: .2em;\n\tfont: inherit;\n\tpadding: .2em .3em;\n\tcolor: white;\n\ttext-shadow: 0 1px black;\n\tfont-weight: bold;\n}\n\n.toolbar a:hover .toolbar a:focus, .toolbar button:hover, .toolbar button:focus {\n\tbackground: #94c8ff;\n}\n\n.toolbar a:active, .toolbar button:active {\n\tbackground: #3465a4;\n}\n\n.sec-code {\n\tborder-radius: .3em;\n\toverflow: hidden;\n\tbox-shadow: 0 1px white inset, 0 .06em .06em #0008;\n\tbackground: #bdf;\n\tmargin: 0 .4em;\n\tborder: 1px solid #3465a4;\n}\n\n.hdb h3 {\n\tmargin: 0;\n\tfont-size: 1em;\n\tpadding: .2em .4em 0 .4em;\n}\n\n.code-container {\n\tdisplay: grid;\n\tline-height: 1.2em;\n\theight: calc(12 * 1.2em);\n\tborder-radius: 0 0 .2em .2em;\n\toverflow: auto;\n\tscrollbar-width: thin;\n\tscrollbar-color: #0003 transparent;\n}\n\n.code, #console, #console-input {\n\tfont-family: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace;\n}\n\n.code {\n\twidth: 0;\n\tmargin: 0;\n\tpadding-left: 1ch;\n\ttab-size: 2;\n\t-moz-tab-size: 2;\n\t-o-tab-size: 2;\n}\n\n.current {\n\tfont-weight: bold;\n\tbackground: #abf;\n}\n\n#console {\n\toverflow-y: scroll;\n\tscrollbar-width: thin;\n\tscrollbar-color: #afc2db transparent;\n\theight: calc(12 * 1.2em);\n\tlist-style: none;\n\tpadding-left: 0;\n\tmargin: 0 .4em .4em .4em;\n\tposition: relative;\n\tword-wrap: break-word;\n}\n\n#console>*+* {\n\tmargin-top: .5em;\n}\n\n.console-entry>* {\n\tdisplay: block;\n}\n\n.console-entry .input  { color: #3465a4; }\n.console-entry .output { color: #333; }\n\n.console-entry .input:before  { content: \'>> \' }\n.console-entry .output:before { content: \'<- \' }\n\n#console-form {\n\tmargin: 0 .4em .4em .4em;\n}\n\n#console-input {\n\twidth: 100%;\n\tfont-size: inherit;\n}\n\n.token.tagname { font-weight: bold; }\n.token.attr, .token.builtin, .token.italic { font-style: italic; }\n.token.string { opacity: .8; }\n.token.keyword { color: #3465a4; }\n.token.bold, .token.punctuation, .token.operator { font-weight: bold; }\n</style>\n</div>\n',document.body.appendChild(e),N.processNode(t.querySelector(".hdb"))},N});
//# sourceMappingURL=_hyperscript_w9y.min.js.map
